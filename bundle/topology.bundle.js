!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MA=e():t.MA=e()}(window,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=27)}([function(t,e,i){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),r(i(17)),r(i(18)),r(i(13))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,i,r,n){this.x=t,this.y=e,this.x=this.x<<0,this.y=this.y<<0,this.direction=i,this.anchorIndex=r,this.id=n}return t.prototype.clone=function(){return new t(this.x,this.y,this.direction,this.anchorIndex,this.id)},t.prototype.hit=function(t,e){return void 0===e&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},t.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,r=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=r,this},t}();e.Point=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Bottom=3]="Bottom",t[t.Left=4]="Left"}(e.Direction||(e.Direction={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),n=i(23),o=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.center=new r.Point(0,0),this.x=this.x<<0,this.y=this.y<<0,this.width=this.width<<0,this.height=this.height<<0,this.ex=this.x+this.width,this.ey=this.y+this.height,this.calceCenter()}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.hit=function(t,e){return void 0===e&&(e=0),t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},t.prototype.hitRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},t.prototype.hitRotate=function(t,e,i){for(var r=this.toPoints(),o=0,h=r;o<h.length;o++){h[o].rotate(e,i)}return n.pointInRect(t,r)},t.prototype.calceCenter=function(){this.center.x=this.x+this.width/2<<0,this.center.y=this.y+this.height/2<<0},t.prototype.toPoints=function(){return[new r.Point(this.x,this.y),new r.Point(this.ex,this.y),new r.Point(this.ex,this.ey),new r.Point(this.x,this.ey)]},t}();e.Rect=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,i,r,n){this.x=t,this.y=e,this.x=this.x<<0,this.y=this.y<<0,this.direction=i,this.anchorIndex=r,this.id=n}return t.prototype.clone=function(){var e=new t(this.x,this.y,this.direction,this.anchorIndex,this.id);return this.data&&(e.data=this.data),e},t.prototype.hit=function(t,e){return void 0===e&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},t.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,r=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=r,this},t}();e.Point=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(6),n=i(24),o=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.center=new r.Point(0,0),this.x=this.x<<0,this.y=this.y<<0,this.width=this.width<<0,this.height=this.height<<0,this.ex=this.x+this.width,this.ey=this.y+this.height,this.calceCenter()}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.hit=function(t,e){return void 0===e&&(e=0),t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},t.prototype.hitRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},t.prototype.hitRotate=function(t,e,i){for(var r=this.toPoints(),o=0,h=r;o<h.length;o++){h[o].rotate(e,i)}return n.pointInRect(t,r)},t.prototype.calceCenter=function(){this.center.x=this.x+this.width/2<<0,this.center.y=this.y+this.height/2<<0},t.prototype.toPoints=function(){return[new r.Point(this.x,this.y),new r.Point(this.ex,this.y),new r.Point(this.ex,this.ey),new r.Point(this.x,this.ey)]},t}();e.Rect=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,i,r,n){this.x=t,this.y=e,this.x=this.x<<0,this.y=this.y<<0,this.direction=i,this.anchorIndex=r,this.id=n}return t.prototype.clone=function(){var e=new t(this.x,this.y,this.direction,this.anchorIndex,this.id);return this.data&&(e.data=this.data),e},t.prototype.hit=function(t,e){return void 0===e&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},t.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,r=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=r,this},t}();e.Point=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Bottom=3]="Bottom",t[t.Left=4]="Left"}(e.Direction||(e.Direction={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Bottom=3]="Bottom",t[t.Left=4]="Left"}(e.Direction||(e.Direction={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(4),n=i(26),o=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.center=new r.Point(0,0),this.x=this.x<<0,this.y=this.y<<0,this.width=this.width<<0,this.height=this.height<<0,this.ex=this.x+this.width,this.ey=this.y+this.height,this.calceCenter()}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.hit=function(t,e){return void 0===e&&(e=0),t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},t.prototype.hitRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},t.prototype.hitRotate=function(t,e,i){for(var r=this.toPoints(),o=0,h=r;o<h.length;o++){h[o].rotate(e,i)}return n.pointInRect(t,r)},t.prototype.calceCenter=function(){this.center.x=this.x+this.width/2<<0,this.center.y=this.y+this.height/2<<0},t.prototype.toPoints=function(){return[new r.Point(this.x,this.y),new r.Point(this.ex,this.y),new r.Point(this.ex,this.ey),new r.Point(this.x,this.ey)]},t}();e.Rect=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(16),n=i(25),o=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.center=new r.Point(0,0),this.x=this.x<<0,this.y=this.y<<0,this.width=this.width<<0,this.height=this.height<<0,this.ex=this.x+this.width,this.ey=this.y+this.height,this.calceCenter()}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.hit=function(t,e){return void 0===e&&(e=0),t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e},t.prototype.hitRect=function(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey},t.prototype.hitRotate=function(t,e,i){for(var r=this.toPoints(),o=0,h=r;o<h.length;o++){h[o].rotate(e,i)}return n.pointInRect(t,r)},t.prototype.calceCenter=function(){this.center.x=this.x+this.width/2<<0,this.center.y=this.y+this.height/2<<0},t.prototype.toPoints=function(){return[new r.Point(this.x,this.y),new r.Point(this.ex,this.y),new r.Point(this.ex,this.ey),new r.Point(this.x,this.ey)]},t}();e.Rect=o},function(t,e,i){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),r(i(20)),r(i(21)),r(i(15))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.data={},e.observers={}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(12),n=function(){function t(t,e,i){this.key="",this.id=t,this.key=e,this.fn=i}return t.prototype.unsubcribe=function(){delete r.observers[this.id]},t}();e.Observer=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.data={},e.observers={}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(14),n=function(){function t(t,e,i){this.key="",this.id=t,this.key=e,this.fn=i}return t.prototype.unsubcribe=function(){delete r.observers[this.id]},t}();e.Observer=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,i,r,n){this.x=t,this.y=e,this.x=this.x<<0,this.y=this.y<<0,this.direction=i,this.anchorIndex=r,this.id=n}return t.prototype.clone=function(){var e=new t(this.x,this.y,this.direction,this.anchorIndex,this.id);return this.data&&(e.data=this.data),e},t.prototype.hit=function(t,e){return void 0===e&&(e=5),t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e},t.prototype.rotate=function(t,e){if(!t||360===t)return this;t*=Math.PI/180;var i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,r=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=r,this},t}();e.Point=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.get=function(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(i))?decodeURIComponent(e[2]):""},t.set=function(t,e,i){var r=window,n=r.escape(t)+"="+r.escape(e)+";";(i||(i={}),i.expires)&&(n+="expires="+new Date((new Date).getTime()+1e3*i.expires*60*60*24).toUTCString()+";");i.path&&(n+="path="+i.path+";"),i.domain&&(n+="domain="+i.domain+";"),document.cookie=n},t.delete=function(e,i){t.get(e)&&(i||(i={}),i.expires=-1,t.set(e,"",i))},t}();e.Cookie=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(12),n=i(13),o=i(19),h=function(){function t(){}return t.get=function(t){if(!t&&void 0===t)return r.data;for(var e=t.split("."),i=r.data,n=0,o=e;n<o.length;n++){if(void 0===(i=i[o[n]]))return}return i},t.set=function(e,i){for(var n=e.split("."),o=r.data,h=0;h<n.length-1;++h)o[n[h]]||(o[n[h]]={}),o=o[n[h]];for(var s in o[n[n.length-1]]=i,r.observers)e===r.observers[s].key?r.observers[s].fn(i):0===e.indexOf(r.observers[s].key)&&r.observers[s].fn(t.get(r.observers[s].key))},t.updated=function(e){for(var i in r.observers)0===e.indexOf(r.observers[i].key)&&r.observers[i].fn(t.get(r.observers[i].key))},t.subcribe=function(e,i){var h=o.s8(),s=new n.Observer(h,e,i);r.observers[h]=s;var c=t.get(e);return null!=c&&i(c),s},t}();e.Store=h},function(t,e,i){"use strict";function r(){return(65536*(1+Math.random())|0).toString(16).substring(1)}Object.defineProperty(e,"__esModule",{value:!0}),e.s4=r,e.s8=function(){return r()+r()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.get=function(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(i))?decodeURIComponent(e[2]):""},t.set=function(t,e,i){var r=window,n=r.escape(t)+"="+r.escape(e)+";";(i||(i={}),i.expires)&&(n+="expires="+new Date((new Date).getTime()+1e3*i.expires*60*60*24).toUTCString()+";");i.path&&(n+="path="+i.path+";"),i.domain&&(n+="domain="+i.domain+";"),document.cookie=n},t.delete=function(e,i){t.get(e)&&(i||(i={}),i.expires=-1,t.set(e,"",i))},t}();e.Cookie=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(14),n=i(15),o=i(22),h=function(){function t(){}return t.get=function(t){if(!t&&void 0===t)return r.data;for(var e=t.split("."),i=r.data,n=0,o=e;n<o.length;n++){if(void 0===(i=i[o[n]]))return}return i},t.set=function(e,i){for(var n=e.split("."),o=r.data,h=0;h<n.length-1;++h)o[n[h]]||(o[n[h]]={}),o=o[n[h]];for(var s in o[n[n.length-1]]=i,r.observers)e===r.observers[s].key?r.observers[s].fn(i):0===e.indexOf(r.observers[s].key)&&r.observers[s].fn(t.get(r.observers[s].key))},t.updated=function(e){for(var i in r.observers)0===e.indexOf(r.observers[i].key)&&r.observers[i].fn(t.get(r.observers[i].key))},t.subcribe=function(e,i){var h=o.s8(),s=new n.Observer(h,e,i);r.observers[h]=s;var c=t.get(e);return null!=c&&i(c),s},t}();e.Store=h},function(t,e,i){"use strict";function r(){return(65536*(1+Math.random())|0).toString(16).substring(1)}Object.defineProperty(e,"__esModule",{value:!0}),e.s4=r,e.s8=function(){return r()+r()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(1);function n(t,e){if(e.length<3)return!1;for(var i=!1,r=e[e.length-1],n=0,o=e;n<o.length;n++){var h=o[n];(h.y<t.y&&r.y>=t.y||h.y>=t.y&&r.y<t.y)&&h.x+(t.y-h.y)*(r.x-h.x)/(r.y-h.y)>t.x&&(i=!i),r=h}return i}e.pointInRect=n,e.pointInLine=function(t,e,i){return n(t,[new r.Point(e.x-8,e.y-8),new r.Point(i.x-8,i.y-8),new r.Point(i.x+8,i.y+8),new r.Point(e.x+8,e.y+8)])},e.lineLen=function(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},e.curveLen=function(t,e,i,r){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+t.x+" "+t.y+" C"+e.x+" "+e.y+" "+i.x+" "+i.y+" "+r.x+" "+r.y),0|n.getTotalLength()},e.pSBC=function(t,e,i,r){var n,o,h,s,c,a,l,d="string"==typeof i,y=parseInt,x=Math.round;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!==e[0]&&"#"!==e[0]||i&&!d)return null;var f=function(t){var e,i=t.length,r={};if(i>9){if(e=t=t.split(","),n=e[0],o=e[1],h=e[2],d=e[3],(i=t.length)<3||i>4)return null;r.r=y("a"===n[3]?n.slice(5):n.slice(4)),r.g=y(o),r.b=y(h),r.a=d?parseFloat(d):-1}else{if(8===i||6===i||i<4)return null;i<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(i>4?t[4]+t[4]:"")),t=y(t.slice(1),16),9===i||5===i?(r.r=t>>24&255,r.g=t>>16&255,r.b=t>>8&255,r.a=x((255&t)/.255)/1e3):(r.r=t>>16,r.g=t>>8&255,r.b=255&t,r.a=-1)}return r};return l=e.length>9,l=d?i.length>9||"c"===i&&!l:l,c=f(e),s=t<0,a=i&&"c"!==i?f(i):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(t=s?-1*t:t),c&&a?(r?(n=x(s*c.r+t*a.r),o=x(s*c.g+t*a.g),h=x(s*c.b+t*a.b)):(n=x(Math.pow(s*Math.pow(c.r,2)+t*Math.pow(a.r,2),.5)),o=x(Math.pow(s*Math.pow(c.g,2)+t*Math.pow(a.g,2),.5)),h=x(Math.pow(s*Math.pow(c.b,2)+t*Math.pow(a.b,2),.5))),d=c.a,a=a.a,d=(c=d>=0||a>=0)?d<0?a:a<0?d:d*s+a*t:0,l?"rgb"+(c?"a(":"(")+n+","+o+","+h+(c?","+x(1e3*d)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*h+(c?x(255*d):0)).toString(16).slice(1,c?void 0:-2)):null}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(6);function n(t,e){if(e.length<3)return!1;for(var i=!1,r=e[e.length-1],n=0,o=e;n<o.length;n++){var h=o[n];(h.y<t.y&&r.y>=t.y||h.y>=t.y&&r.y<t.y)&&h.x+(t.y-h.y)*(r.x-h.x)/(r.y-h.y)>t.x&&(i=!i),r=h}return i}e.pointInRect=n,e.pointInLine=function(t,e,i){return n(t,[new r.Point(e.x-8,e.y-8),new r.Point(i.x-8,i.y-8),new r.Point(i.x+8,i.y+8),new r.Point(e.x+8,e.y+8)])},e.lineLen=function(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},e.curveLen=function(t,e,i,r){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+t.x+" "+t.y+" C"+e.x+" "+e.y+" "+i.x+" "+i.y+" "+r.x+" "+r.y),0|n.getTotalLength()},e.pSBC=function(t,e,i,r){var n,o,h,s,c,a,l,d="string"==typeof i,y=parseInt,x=Math.round;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!==e[0]&&"#"!==e[0]||i&&!d)return null;var f=function(t){var e,i=t.length,r={};if(i>9){if(e=t=t.split(","),n=e[0],o=e[1],h=e[2],d=e[3],(i=t.length)<3||i>4)return null;r.r=y("a"===n[3]?n.slice(5):n.slice(4)),r.g=y(o),r.b=y(h),r.a=d?parseFloat(d):-1}else{if(8===i||6===i||i<4)return null;i<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(i>4?t[4]+t[4]:"")),t=y(t.slice(1),16),9===i||5===i?(r.r=t>>24&255,r.g=t>>16&255,r.b=t>>8&255,r.a=x((255&t)/.255)/1e3):(r.r=t>>16,r.g=t>>8&255,r.b=255&t,r.a=-1)}return r};return l=e.length>9,l=d?i.length>9||"c"===i&&!l:l,c=f(e),s=t<0,a=i&&"c"!==i?f(i):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(t=s?-1*t:t),c&&a?(r?(n=x(s*c.r+t*a.r),o=x(s*c.g+t*a.g),h=x(s*c.b+t*a.b)):(n=x(Math.pow(s*Math.pow(c.r,2)+t*Math.pow(a.r,2),.5)),o=x(Math.pow(s*Math.pow(c.g,2)+t*Math.pow(a.g,2),.5)),h=x(Math.pow(s*Math.pow(c.b,2)+t*Math.pow(a.b,2),.5))),d=c.a,a=a.a,d=(c=d>=0||a>=0)?d<0?a:a<0?d:d*s+a*t:0,l?"rgb"+(c?"a(":"(")+n+","+o+","+h+(c?","+x(1e3*d)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*h+(c?x(255*d):0)).toString(16).slice(1,c?void 0:-2)):null}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(16);function n(t,e){if(e.length<3)return!1;for(var i=!1,r=e[e.length-1],n=0,o=e;n<o.length;n++){var h=o[n];(h.y<t.y&&r.y>=t.y||h.y>=t.y&&r.y<t.y)&&h.x+(t.y-h.y)*(r.x-h.x)/(r.y-h.y)>t.x&&(i=!i),r=h}return i}e.pointInRect=n,e.pointInLine=function(t,e,i){return n(t,[new r.Point(e.x-8,e.y-8),new r.Point(i.x-8,i.y-8),new r.Point(i.x+8,i.y+8),new r.Point(e.x+8,e.y+8)])},e.lineLen=function(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},e.curveLen=function(t,e,i,r){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+t.x+" "+t.y+" C"+e.x+" "+e.y+" "+i.x+" "+i.y+" "+r.x+" "+r.y),0|n.getTotalLength()},e.pSBC=function(t,e,i,r){var n,o,h,s,c,a,l,d="string"==typeof i,y=parseInt,x=Math.round;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!==e[0]&&"#"!==e[0]||i&&!d)return null;var f=function(t){var e,i=t.length,r={};if(i>9){if(e=t=t.split(","),n=e[0],o=e[1],h=e[2],d=e[3],(i=t.length)<3||i>4)return null;r.r=y("a"===n[3]?n.slice(5):n.slice(4)),r.g=y(o),r.b=y(h),r.a=d?parseFloat(d):-1}else{if(8===i||6===i||i<4)return null;i<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(i>4?t[4]+t[4]:"")),t=y(t.slice(1),16),9===i||5===i?(r.r=t>>24&255,r.g=t>>16&255,r.b=t>>8&255,r.a=x((255&t)/.255)/1e3):(r.r=t>>16,r.g=t>>8&255,r.b=255&t,r.a=-1)}return r};return l=e.length>9,l=d?i.length>9||"c"===i&&!l:l,c=f(e),s=t<0,a=i&&"c"!==i?f(i):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(t=s?-1*t:t),c&&a?(r?(n=x(s*c.r+t*a.r),o=x(s*c.g+t*a.g),h=x(s*c.b+t*a.b)):(n=x(Math.pow(s*Math.pow(c.r,2)+t*Math.pow(a.r,2),.5)),o=x(Math.pow(s*Math.pow(c.g,2)+t*Math.pow(a.g,2),.5)),h=x(Math.pow(s*Math.pow(c.b,2)+t*Math.pow(a.b,2),.5))),d=c.a,a=a.a,d=(c=d>=0||a>=0)?d<0?a:a<0?d:d*s+a*t:0,l?"rgb"+(c?"a(":"(")+n+","+o+","+h+(c?","+x(1e3*d)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*h+(c?x(255*d):0)).toString(16).slice(1,c?void 0:-2)):null}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(4);function n(t,e){if(e.length<3)return!1;for(var i=!1,r=e[e.length-1],n=0,o=e;n<o.length;n++){var h=o[n];(h.y<t.y&&r.y>=t.y||h.y>=t.y&&r.y<t.y)&&h.x+(t.y-h.y)*(r.x-h.x)/(r.y-h.y)>t.x&&(i=!i),r=h}return i}e.pointInRect=n,e.pointInLine=function(t,e,i){return n(t,[new r.Point(e.x-8,e.y-8),new r.Point(i.x-8,i.y-8),new r.Point(i.x+8,i.y+8),new r.Point(e.x+8,e.y+8)])},e.lineLen=function(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))},e.curveLen=function(t,e,i,r){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M"+t.x+" "+t.y+" C"+e.x+" "+e.y+" "+i.x+" "+i.y+" "+r.x+" "+r.y),0|n.getTotalLength()},e.pSBC=function(t,e,i,r){var n,o,h,s,c,a,l,d="string"==typeof i,y=parseInt,x=Math.round;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!==e[0]&&"#"!==e[0]||i&&!d)return null;var f=function(t){var e,i=t.length,r={};if(i>9){if(e=t=t.split(","),n=e[0],o=e[1],h=e[2],d=e[3],(i=t.length)<3||i>4)return null;r.r=y("a"===n[3]?n.slice(5):n.slice(4)),r.g=y(o),r.b=y(h),r.a=d?parseFloat(d):-1}else{if(8===i||6===i||i<4)return null;i<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(i>4?t[4]+t[4]:"")),t=y(t.slice(1),16),9===i||5===i?(r.r=t>>24&255,r.g=t>>16&255,r.b=t>>8&255,r.a=x((255&t)/.255)/1e3):(r.r=t>>16,r.g=t>>8&255,r.b=255&t,r.a=-1)}return r};return l=e.length>9,l=d?i.length>9||"c"===i&&!l:l,c=f(e),s=t<0,a=i&&"c"!==i?f(i):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(t=s?-1*t:t),c&&a?(r?(n=x(s*c.r+t*a.r),o=x(s*c.g+t*a.g),h=x(s*c.b+t*a.b)):(n=x(Math.pow(s*Math.pow(c.r,2)+t*Math.pow(a.r,2),.5)),o=x(Math.pow(s*Math.pow(c.g,2)+t*Math.pow(a.g,2),.5)),h=x(Math.pow(s*Math.pow(c.b,2)+t*Math.pow(a.b,2),.5))),d=c.a,a=a.a,d=(c=d>=0||a>=0)?d<0?a:a<0?d:d*s+a*t:0,l?"rgb"+(c?"a(":"(")+n+","+o+","+h+(c?","+x(1e3*d)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*h+(c?x(255*d):0)).toString(16).slice(1,c?void 0:-2)):null}},function(t,e,i){"use strict";function r(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function n(){return r()+r()}i.r(e);class o{constructor(t,e,i,r,n,o){this.x=t,this.y=e,this.x=this.x,this.y=this.y,this.direction=i,this.anchorIndex=r,this.id=n,this.hidden=o}clone(){const t=new o(this.x,this.y,this.direction,this.anchorIndex,this.id,this.hidden);return this.data&&(t.data=this.data),t}hit(t,e=5){return t.x>this.x-e&&t.x<this.x+e&&t.y>this.y-e&&t.y<this.y+e}rotate(t,e){if(!t||360===t)return this;t*=Math.PI/180;const i=(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t)+e.x,r=(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t)+e.y;return this.x=i,this.y=r,this}}function h(t,e){if(e.length<3)return!1;let i=!1,r=e[e.length-1];for(const n of e)(n.y<t.y&&r.y>=t.y||n.y>=t.y&&r.y<t.y)&&n.x+(t.y-n.y)*(r.x-n.x)/(r.y-n.y)>t.x&&(i=!i),r=n;return i}function s(t,e,i){return h(t,[new o(e.x-8,e.y-8),new o(i.x-8,i.y-8),new o(i.x+8,i.y+8),new o(e.x+8,e.y+8)])}function c(t,e){return 0|Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2))}function a(t,e,i,r){let n,o,h,s,c,a,l,d="string"==typeof i;const y=parseInt,x=Math.round;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!==e[0]&&"#"!==e[0]||i&&!d)return null;const f=t=>{let e=t.length;const i={};if(e>9){if([n,o,h,d]=t=t.split(","),(e=t.length)<3||e>4)return null;i.r=y("a"===n[3]?n.slice(5):n.slice(4)),i.g=y(o),i.b=y(h),i.a=d?parseFloat(d):-1}else{if(8===e||6===e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=y(t.slice(1),16),9===e||5===e?(i.r=t>>24&255,i.g=t>>16&255,i.b=t>>8&255,i.a=x((255&t)/.255)/1e3):(i.r=t>>16,i.g=t>>8&255,i.b=255&t,i.a=-1)}return i};return l=e.length>9,l=d?i.length>9||"c"===i&&!l:l,c=f(e),s=t<0,a=i&&"c"!==i?f(i):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(t=s?-1*t:t),c&&a?(r?(n=x(s*c.r+t*a.r),o=x(s*c.g+t*a.g),h=x(s*c.b+t*a.b)):(n=x((s*c.r**2+t*a.r**2)**.5),o=x((s*c.g**2+t*a.g**2)**.5),h=x((s*c.b**2+t*a.b**2)**.5)),d=c.a,a=a.a,d=(c=d>=0||a>=0)?d<0?a:a<0?d:d*s+a*t:0,l?"rgb"+(c?"a(":"(")+n+","+o+","+h+(c?","+x(1e3*d)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*h+(c?x(255*d):0)).toString(16).slice(1,c?void 0:-2)):null}class l{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.center=new o(0,0),this.ex=this.x+this.width,this.ey=this.y+this.height,this.calceCenter()}clone(){return new l(this.x,this.y,this.width,this.height)}hit(t,e=0){return t.x>this.x-e&&t.x<this.ex+e&&t.y>this.y-e&&t.y<this.ey+e}hitRect(t){return t.x>this.x&&t.x<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.y>this.y&&t.y<this.ey||t.ex>this.x&&t.ex<this.ex&&t.ey>this.y&&t.ey<this.ey||t.x>this.x&&t.x<this.ex&&t.ey>this.y&&t.ey<this.ey}hitRotate(t,e,i){const r=this.toPoints();for(const t of r)t.rotate(e,i);return h(t,r)}calceCenter(){this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2}toPoints(){return[new o(this.x,this.y),new o(this.ex,this.y),new o(this.ex,this.ey),new o(this.x,this.ey)]}scale(t,e){e||(e=this.center),this.x=e.x-(e.x-this.x)*t,this.y=e.y-(e.y-this.y)*t,this.width*=t,this.height*=t,this.ex=this.x+this.width,this.ey=this.y+this.height,this.calceCenter()}}class d{constructor(t){this.id="",this.name="",this.rect=new l(0,0,0,0),this.lineWidth=1,this.rotate=0,this.offsetRotate=0,this.globalAlpha=1,this.dash=0,this.strokeStyle="",this.fillStyle="",this.font={color:"",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,fontStyle:"normal",fontWeight:"normal",textAlign:"center",textBaseline:"middle"},this.animateStart=0,this.animateCycleIndex=0,t?(this.id=t.id||n(),this.name=t.name||"",t.rect&&(this.rect=new l(t.rect.x,t.rect.y,t.rect.width,t.rect.height)),this.dash=t.dash||0,this.lineWidth=t.lineWidth||1,this.strokeStyle=t.strokeStyle||"",this.fillStyle=t.fillStyle||"",this.globalAlpha=t.globalAlpha||1,this.rotate=t.rotate||0,this.offsetRotate=t.offsetRotate||0,t.font&&Object.assign(this.font,t.font),this.animateCycle=t.animateCycle,this.data=t.data||""):this.id=n()}render(t){switch(t.save(),(this.rotate||this.offsetRotate)&&(t.translate(this.rect.center.x,this.rect.center.y),t.rotate((this.rotate+this.offsetRotate)*Math.PI/180),t.translate(-this.rect.center.x,-this.rect.center.y)),this.lineWidth>1&&(t.lineWidth=this.lineWidth),this.strokeStyle?t.strokeStyle=this.strokeStyle:t.strokeStyle="#333",this.fillStyle?t.fillStyle=this.fillStyle:t.fillStyle="transparent",this.globalAlpha<1&&(t.globalAlpha=this.globalAlpha),this.dash){case 1:t.setLineDash([5,5]);break;case 2:t.setLineDash([10,10]);break;case 3:t.setLineDash([10,10,2,10])}if(this.draw(t),t.restore(),this.children)for(const e of this.children)e.render(t)}hit(t,e=0){if(!this.rotate)return this.rect.hit(t,e);const i=this.rect.toPoints();for(const t of i)t.rotate(this.rotate,this.rect.center);return h(t,i)}}function y(t,e){const i=e.rect.width*e.borderRadius,r=e.rect.height*e.borderRadius;let n=i<r?i:r;e.rect.width<2*n&&(n=e.rect.width/2),e.rect.height<2*n&&(n=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+n,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,n),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,n),t.closePath(),t.fill(),t.stroke()}function x(t,e){t.beginPath(),t.ellipse(e.rect.x+e.rect.width/2,e.rect.y+e.rect.height/2,e.rect.width/2,e.rect.height/2,0,0,2*Math.PI),t.fill(),t.stroke()}function f(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/2,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+e.rect.height),t.closePath(),t.fill(),t.stroke()}function u(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/2,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.width/2,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+e.rect.height/2),t.closePath(),t.fill(),t.stroke()}function g(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+e.rect.width,e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height),t.closePath(),t.fill(),t.stroke()}function w(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x,e.rect.y+2*e.rect.height/3),t.closePath(),t.fill(),t.stroke()}function p(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height/3),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+e.rect.height),t.lineTo(e.rect.x+(e.rect.width-e.rect.height/2),e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+2*e.rect.height/3),t.lineTo(e.rect.x+e.rect.height/2,e.rect.y+e.rect.height),t.closePath(),t.fill(),t.stroke()}function v(t){const e=[];let i="";for(let r=0;r<t.length;++r){const n=t.charCodeAt(r);n<33||n>126?(i&&(e.push(i),i=""),e.push(t[r])):i+=t[r]}return i&&e.push(i),e}function m(t,e,i){const r=[];let n=e[0]||"";for(let o=1;o<e.length;++o){const h=e[o]||"";t.measureText(n+h).width<i?n+=h:(r.push(n),n=h)}return r.push(n),r}function P(t,e){if(!e.text)return;t.save(),t.beginPath(),t.font=`${e.font.fontStyle||"normal"} normal ${e.font.fontWeight||"normal"} ${e.font.fontSize}px/${e.font.lineHeight} ${e.font.fontFamily}`,e.font.color?t.fillStyle=e.font.color:t.fillStyle="#333",e.font.textAlign&&(t.textAlign=e.font.textAlign),e.font.textBaseline&&(t.textBaseline=e.font.textBaseline);const i=e.getTextRect(),r=[],n=e.text.split(/[\n,]/g);for(let e=0;e<n.length;++e){const o=m(t,v(n[e]),i.width);r.push.apply(r,o)}const o=e.font.fontSize*e.font.lineHeight;let h=e.textMaxLine;const s=i.height/o;h||(h=r.length>s?s:r.length);let c=i.x+i.width/2,a=i.y+(i.height-o*h)/2+4*o/7;switch(t.textAlign){case"left":c=i.x;break;case"right":c=i.x+i.width}switch(t.textBaseline){case"top":a=i.y+(o-e.font.fontSize)/2;break;case"bottom":a=i.ey-o*r.length+o}!function(t,e,i,r,n,o,h,s){s=!s||s>e.length?e.length:Math.ceil(s);for(let n=0;n<s-1;++n)t.fillText(e[n],i,r+n*h);if(s<e.length){let o=e[s-1]+"...";t.measureText(o).width>n&&(o=e[s-1].substr(0,e[s-1].length-2)+"..."),t.fillText(o,i,r+(s-1)*h)}else t.fillText(e[s-1],i,r+(s-1)*h)}(t,r,c,a,i.width,i.height,o,h),t.restore()}function R(t,e){t.beginPath();const i=e.rect.y+e.rect.height/2;t.moveTo(e.rect.x,i),t.lineTo(e.rect.x+e.rect.width,i),t.stroke()}var L;function b(t){t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y,L.Up)),t.anchors.push(new o(t.rect.x+3*t.rect.width/4,t.rect.y+t.rect.height/2,L.Right)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,L.Bottom)),t.anchors.push(new o(t.rect.x+t.rect.width/4,t.rect.y+t.rect.height/2,L.Left))}function T(t){t.anchors.push(new o(t.rect.x,t.rect.y+t.rect.height/2,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,L.Right))}function S(t){t.anchors.push(new o(t.rect.x,t.rect.y+t.rect.height/2,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,L.Right))}function M(t){let e=t.rect.width/2,i=t.rect.height/2;e>i?e=i:i=e;let r=t.rect.height/10;r<10&&(r=10),t.iconRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+r,e,i)}function I(t){let e=t.rect.height/20;e<5&&(e=0),t.textRect=new l(t.rect.x+t.rect.width/4,t.rect.y+2*t.rect.height/3-e,t.rect.width/2,t.rect.height/3-5);const i=5*t.rect.width/7,r=5*t.rect.height/7;t.fullTextRect=new l(t.rect.x+(t.rect.width-i)/2,t.rect.y+(t.rect.height-r)/2,i,r)}function k(t){let e=2*t.rect.width/7,i=2*t.rect.height/7;e>i?e=i:i=e;let r=e;r<10&&(r=10),t.iconRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+r,e,i)}function C(t){t.textRect=new l(t.rect.x+t.rect.width/4,t.rect.y+2*t.rect.height/3,t.rect.width/2,t.rect.height/3-5);const e=t.rect.width/2,i=3*t.rect.height/7;t.fullTextRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+t.rect.height/2-5,e,i)}function A(t){let e=t.rect.width/3,i=t.rect.height/3;e>i?e=i:i=e;let r=t.rect.width/5;r<10&&(r=10),t.iconRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+r,e,i)}function N(t){let e=t.rect.height/10;e<5&&(e=0),t.textRect=new l(t.rect.x+t.rect.width/3,t.rect.y+2*t.rect.height/3-e,t.rect.width/3,t.rect.height/3-5);const i=t.rect.width/2,r=1*t.rect.height/2;t.fullTextRect=new l(t.rect.x+(t.rect.width-i)/2,t.rect.y+t.rect.height/4,i,r)}function z(t){t.iconRect=new l(0,0,0,0)}function D(t){t.textRect=new l(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3,t.rect.width-t.rect.height/2,t.rect.height/3),t.fullTextRect=t.textRect}function W(t){t.iconRect=new l(0,0,0,0)}function F(t){t.textRect=new l(t.rect.x,t.rect.y+t.rect.height/3,t.rect.width-t.rect.height/2,t.rect.height/3),t.fullTextRect=t.textRect}function _(t){t.iconRect=new l(0,0,0,0)}function B(t){t.textRect=new l(t.rect.x+t.rect.height/2,t.rect.y+t.rect.height/3,t.rect.width-t.rect.height,t.rect.height/3),t.fullTextRect=t.textRect}function O(t){t.iconRect=new l(0,0,0,0)}function H(t){t.fullTextRect=new l(t.rect.x+10,t.rect.y+t.rect.height/2-20,t.rect.width-20,20),t.textRect=t.fullTextRect}function E(t,e){t.beginPath(),t.moveTo(e.from.x,e.from.y),t.lineTo(e.to.x,e.to.y),t.stroke()}function U(t,e){}function j(t){t.controlPoints=[]}!function(t){t[t.Up=1]="Up",t[t.Right=2]="Right",t[t.Bottom=3]="Bottom",t[t.Left=4]="Left"}(L||(L={}));const Y=50;function X(t,e){t.beginPath(),t.moveTo(e.from.x,e.from.y);for(const i of e.controlPoints)t.lineTo(i.x,i.y);t.lineTo(e.to.x,e.to.y),t.stroke()}function $(t,e){t.fillStyle="#fff",t.lineWidth=2;for(const i of e.controlPoints)t.beginPath(),t.arc(i.x,i.y,4,0,2*Math.PI),t.stroke(),t.fill()}function K(t){t.controlPoints=[];const e=V(t.from,t.to);t.from.direction&&t.controlPoints.push(e);const i=V(t.to,t.from);let r;switch(e.direction){case L.Up:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y>e.y)return e.direction===L.Up&&t.y-e.y>3*Y?t.x<e.x?e.x-t.x<Y?[new o(t.x-2*Y,t.y),new o(t.x-2*Y,e.y)]:[new o(t.x,e.y)]:t.x-e.x<Y?[new o(t.x+2*Y,t.y),new o(t.x+2*Y,e.y)]:[new o(t.x,e.y)]:e.direction===L.Left&&t.x>e.x||e.direction===L.Right&&t.x<e.x?[new o(e.x,t.y)]:[new o(t.x,e.y)];if(e.direction===L.Bottom){if(t.x<e.x)return J(t,e);{const i=J(e,t);return[i[1],i[0]]}}return[new o(e.x,t.y)]}(e,i);break;case L.Right:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x<e.x)return e.direction===L.Right&&e.x-t.x>3*Y?t.y<e.y?e.y-t.y<Y?[new o(t.x,t.y-2*Y),new o(e.x,t.y-2*Y)]:[new o(e.x,t.y)]:t.y-e.y<Y?[new o(t.x,t.y+2*Y),new o(e.x,t.y+2*Y)]:[new o(e.x,t.y)]:e.direction===L.Right||e.direction===L.Up&&t.y<e.y||e.direction===L.Bottom&&t.y>e.y?[new o(e.x,t.y)]:[new o(t.x,e.y)];if(e.direction===L.Left){if(t.y<e.y)return Q(t,e);{const i=Q(e,t);return[i[1],i[0]]}}return[new o(t.x,e.y)]}(e,i);break;case L.Bottom:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.y<e.y)return e.direction===L.Bottom&&e.y-t.y>3*Y?t.x<e.x?e.x-t.x<Y?[new o(t.x-2*Y,t.y),new o(t.x-2*Y,e.y)]:[new o(t.x,e.y)]:t.x-e.x<Y?[new o(t.x+2*Y,t.y),new o(t.x+2*Y,e.y)]:[new o(t.x,e.y)]:e.direction===L.Left&&t.x>e.x||e.direction===L.Right&&t.x<e.x?[new o(e.x,t.y)]:[new o(t.x,e.y)];if(e.direction===L.Up){if(t.x<e.x)return J(t,e);{const i=J(e,t);return[i[1],i[0]]}}return[new o(e.x,t.y)]}(e,i);break;case L.Left:r=function(t,e){if(t.x===e.x||t.y===e.y)return[];if(t.x>e.x)return e.direction===L.Left&&t.x-e.x>3*Y?t.y<e.y?e.y-t.y<Y?[new o(t.x,t.y+2*Y),new o(e.x,t.y+2*Y)]:[new o(e.x,t.y)]:t.y-e.y<Y?[new o(t.x,t.y-2*Y),new o(e.x,t.y-2*Y)]:[new o(e.x,t.y)]:e.direction===L.Left||e.direction===L.Up&&t.y<e.y||e.direction===L.Bottom&&t.y>e.y?[new o(e.x,t.y)]:[new o(t.x,e.y)];if(e.direction===L.Left){if(t.y<e.y)return Q(t,e);{const i=Q(e,t);return[i[1],i[0]]}}return[new o(t.x,e.y)]}(e,i)}t.controlPoints.push.apply(t.controlPoints,r),t.to.direction&&t.controlPoints.push(i)}function q(t,e){if(!e.controlPoints||!e.controlPoints.length)return s(t,e.from,e.to);if(s(t,e.from,e.controlPoints[0]))return!0;if(s(t,e.to,e.controlPoints[e.controlPoints.length-1]))return!0;for(let i=0;i<e.controlPoints.length-1;++i)if(s(t,e.controlPoints[i],e.controlPoints[i+1]))return!0;return!1}function G(t,e){const i=[e.from];i.push.apply(i,e.controlPoints),i.push(e.to);for(const e of i)Math.abs(t.x-e.x)<7&&(t.x=e.x),Math.abs(t.y-e.y)<7&&(t.y=e.y)}function V(t,e){const i=t.clone();switch(t.direction){case L.Up:e.y<t.y?i.y-=Math.floor((t.y-e.y)/2):i.y-=Y;break;case L.Right:e.x>t.x?i.x+=Math.floor((e.x-t.x)/2):i.x+=Y;break;case L.Bottom:e.y>t.y?i.y+=Math.floor((e.y-t.y)/2):i.y+=Y;break;case L.Left:e.x<t.x?i.x-=Math.floor((t.x-e.x)/2):i.x-=Y}return i}function J(t,e){const i=t.x+(e.x-t.x)/2;return[new o(i,t.y),new o(i,e.y)]}function Q(t,e){const i=t.y+(e.y-t.y)/2;return[new o(t.x,i),new o(e.x,i)]}var Z=i(0);const tt=80;function et(t,e){t.beginPath(),t.moveTo(e.from.x,e.from.y),t.bezierCurveTo(e.controlPoints[0].x,e.controlPoints[0].y,e.controlPoints[1].x,e.controlPoints[1].y,e.to.x,e.to.y),t.stroke()}function it(t,e){t.fillStyle=t.strokeStyle+"80",t.lineWidth=1,t.beginPath(),t.moveTo(e.from.x,e.from.y),t.lineTo(e.controlPoints[0].x,e.controlPoints[0].y),t.stroke(),t.beginPath(),t.moveTo(e.to.x,e.to.y),t.lineTo(e.controlPoints[1].x,e.controlPoints[1].y),t.stroke(),t.fillStyle="#fff",t.lineWidth=2;for(const i of e.controlPoints)t.beginPath(),t.arc(i.x,i.y,4,0,2*Math.PI),t.stroke(),t.fill()}function rt(t){t.controlPoints=[ht(t.from,t.to),ht(t.to,t.from)],Z.Store.set("pts-"+t.id,null)}function nt(t,e){let i=Z.Store.get("pts-"+e.id);if(!i){i=[e.from];for(let t=.01;t<1;t+=.01)i.push(ot(t,e.from,e.controlPoints[0],e.controlPoints[1],e.to));i.push(e.to),Z.Store.set("pts-"+e.id,i)}const r=i.length-1;for(let e=0;e<r;++e)if(s(t,i[e],i[e+1]))return!0;return!1}function ot(t,e,i,r,n){const{x:h,y:s}=e,{x:c,y:a}=n,{x:l,y:d}=i,{x:y,y:x}=r;return new o(h*(1-t)*(1-t)*(1-t)+3*l*t*(1-t)*(1-t)+3*y*t*t*(1-t)+c*t*t*t,s*(1-t)*(1-t)*(1-t)+3*d*t*(1-t)*(1-t)+3*x*t*t*(1-t)+a*t*t*t)}function ht(t,e){const i=new o(t.x,t.y,t.direction,t.anchorIndex,t.id);let r=tt;if((t.direction===L.Up||t.direction===L.Bottom)&&Math.abs(t.x-e.x)<3)return e.y>t.y?(r=Math.floor((e.y-t.y)/3),i.y+=r):(r=Math.floor((t.y-e.y)/3),i.y-=r),i;if((t.direction===L.Left||t.direction===L.Right)&&Math.abs(t.y-e.y)<3)return e.x>t.x?(r=Math.floor((e.x-t.x)/3),i.x+=r):(r=Math.floor((t.x-e.x)/3),i.x-=r),i;switch(t.direction){case L.Up:i.y-=r;break;case L.Right:i.x+=r;break;case L.Bottom:i.y+=r;break;case L.Left:i.x-=r}return i}function st(t,e,i,r,n){const h=new l(i.x-17,i.y-5,15,10);r&&1!==r&&h.scale(r,new o(h.x+15,h.y+5)),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x,-i.y),t.moveTo(h.x,h.y),t.lineTo(h.x+h.width,h.y+h.height/2),t.lineTo(h.x,h.y+h.height),t.closePath(),t.lineWidth=2,t.stroke(),n&&(t.fillStyle=n),t.fill()}function ct(t,e,i,r){st(t,e,i,r,"#fff")}function at(t,e,i,r,n){const h=new l(i.x-16,i.y-4,14,8);r&&1!==r&&h.scale(r,new o(h.x+14,h.y+4)),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x,-i.y),t.moveTo(h.x+h.width/2,h.y),t.lineTo(h.x+h.width,h.y+h.height/2),t.lineTo(h.x+h.width/2,h.y+h.height),t.lineTo(h.x,h.y+h.height/2),t.closePath(),t.lineWidth=2,t.stroke(),n&&(t.fillStyle=n),t.fill()}function lt(t,e,i,r){at(t,e,i,r,"#fff")}function dt(t,e,i,r,n){const h=new l(i.x-12,i.y-5,10,10);r&&1!==r&&h.scale(r,new o(h.x+9,h.y+5)),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x,-i.y),t.arc(h.center.x,h.center.y,h.width/2,0,2*Math.PI),t.lineWidth=2,t.stroke(),n&&(t.fillStyle=n),t.fill()}function yt(t,e,i,r){dt(t,e,i,r,"#fff")}function xt(t){t.anchors.push(new o(t.rect.x,t.rect.y+t.rect.height/2,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y,L.Up)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,L.Right)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,L.Bottom));for(let e=10;e<360;e+=10){if(e%90==0)continue;const i=Math.floor(e/90),r=new o(t.rect.center.x+Math.sin(e/180*Math.PI)*t.rect.width/2,t.rect.center.y+Math.cos(e/180*Math.PI)*t.rect.height/2,i);r.hidden=!0,t.anchors.push(r)}}function ft(t,e,i,r){const n=new l(i.x-12,i.y-6,12,12);r&&1!==r&&n.scale(r,new o(n.x+12,n.y+6)),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x,-i.y),t.moveTo(n.x,n.y),t.lineTo(n.x+n.width,n.y+n.height/2),t.lineTo(n.x,n.y+n.height),t.stroke()}function ut(t,e,i,r){const n=new l(i.x-12,i.y-6,12,12);r&&1!==r&&n.scale(r,new o(n.x+12,n.y+6)),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x,-i.y),i.x>e.x?(t.moveTo(n.x,n.y),t.lineTo(n.x+n.width,n.y+n.height/2)):(t.moveTo(n.x+n.width,n.y+n.height/2),t.lineTo(n.x,n.y+n.height)),t.stroke()}function gt(t,e,i,r){const n=new l(i.x-12,i.y-6,12,12);r&&1!==r&&n.scale(r,new o(n.x+12,n.y+6)),t.translate(i.x,i.y),t.rotate(Math.atan2(i.y-e.y,i.x-e.x)),t.translate(-i.x,-i.y),i.x<e.x?(t.moveTo(n.x,n.y),t.lineTo(n.x+n.width,n.y+n.height/2)):(t.moveTo(n.x+n.width,n.y+n.height/2),t.lineTo(n.x,n.y+n.height)),t.stroke()}function wt(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/2,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+2*e.rect.height/5),t.lineTo(e.rect.x+4*e.rect.width/5,e.rect.y+e.rect.height),t.lineTo(e.rect.x+e.rect.width/5,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+2*e.rect.height/5),t.closePath(),t.fill(),t.stroke()}function pt(t){let e=t.rect.width/2,i=t.rect.height/2;e>i?e=i:i=e;let r=t.rect.height/7;r<10&&(r=10),t.iconRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+r,e,i)}function vt(t){t.textRect=new l(t.rect.x+t.rect.width/5,t.rect.y+5*t.rect.height/7,3*t.rect.width/5,t.rect.height/4);const e=3*t.rect.width/5,i=3*t.rect.height/5;t.fullTextRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+t.rect.height/4,e,i)}function mt(t){t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y,L.Up)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+2*t.rect.height/5,L.Right)),t.anchors.push(new o(t.rect.x+4*t.rect.width/5,t.rect.y+t.rect.height,L.Bottom)),t.anchors.push(new o(t.rect.x+t.rect.width/5,t.rect.y+t.rect.height,L.Bottom)),t.anchors.push(new o(t.rect.x,t.rect.y+2*t.rect.height/5,L.Left))}function Pt(t,e){t.beginPath();const i=e.rect.width/5;t.moveTo(e.rect.x+i,e.rect.y),t.lineTo(e.rect.x+e.rect.width-i,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height/2),t.lineTo(e.rect.x+e.rect.width-i,e.rect.y+e.rect.height),t.lineTo(e.rect.x+i,e.rect.y+e.rect.height),t.lineTo(e.rect.x,e.rect.y+e.rect.height/2),t.closePath(),t.fill(),t.stroke()}function Rt(t){t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y,L.Up)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,L.Right)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,L.Bottom)),t.anchors.push(new o(t.rect.x,t.rect.y+t.rect.height/2,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width/10,t.rect.y+t.rect.height/4,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width/10,t.rect.y+3*t.rect.height/4,L.Left)),t.anchors.push(new o(t.rect.x+9*t.rect.width/10,t.rect.y+t.rect.height/4,L.Right)),t.anchors.push(new o(t.rect.x+9*t.rect.width/10,t.rect.y+3*t.rect.height/4,L.Right))}function Lt(t){let e=t.rect.width/2,i=2*t.rect.height/3;e>i?e=i:i=e;let r=t.rect.height/10;r<10&&(r=10),t.iconRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+r,e,i)}function bt(t){t.textRect=new l(t.rect.x+t.rect.width/5,t.rect.y+5*t.rect.height/7,3*t.rect.width/5,t.rect.height/4);const e=3*t.rect.width/5;t.fullTextRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y,e,t.rect.height)}function Tt(t,e){t.beginPath();for(let i=0;i<5;++i)t.lineTo(Math.cos((18+72*i)/180*Math.PI)*e.rect.width/2+e.rect.x+e.rect.width/2,-Math.sin((18+72*i)/180*Math.PI)*e.rect.width/2+e.rect.y+e.rect.height/2),t.lineTo(Math.cos((54+72*i)/180*Math.PI)*e.rect.width/4+e.rect.x+e.rect.width/2,-Math.sin((54+72*i)/180*Math.PI)*e.rect.width/4+e.rect.y+e.rect.height/2);t.closePath(),t.fill(),t.stroke()}function St(t){t.anchors.push(new o(Math.cos(.1*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(.1*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,L.Right)),t.anchors.push(new o(Math.cos(.5*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(.5*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,L.Up)),t.anchors.push(new o(Math.cos(.9*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(.9*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,L.Left)),t.anchors.push(new o(Math.cos(1.3*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(1.3*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,L.Bottom)),t.anchors.push(new o(Math.cos(1.7*Math.PI)*t.rect.width/2+t.rect.x+t.rect.width/2,-Math.sin(1.7*Math.PI)*t.rect.width/2+t.rect.y+t.rect.height/2,L.Bottom))}function Mt(t){t.iconRect=new l(0,0,0,0)}function It(t){const e=2*t.rect.width/5,i=2*t.rect.height/5;t.fullTextRect=new l(t.rect.x+(t.rect.width-e)/2,t.rect.y+(t.rect.height-i)/2,e,i),t.textRect=t.fullTextRect}function kt(t,e){t.beginPath(),t.moveTo(e.rect.x+e.rect.width/5,e.rect.y+13*e.rect.height/16),t.bezierCurveTo(e.rect.x-e.rect.width/15,e.rect.y+13*e.rect.height/16,e.rect.x-e.rect.width/15,e.rect.y+7*e.rect.height/16,e.rect.x+e.rect.width/5,e.rect.y+7*e.rect.height/16),t.bezierCurveTo(e.rect.x+e.rect.width/5,e.rect.y,e.rect.x+4*e.rect.width/5,e.rect.y,e.rect.x+4*e.rect.width/5,e.rect.y+7*e.rect.height/16),t.bezierCurveTo(e.rect.x+16*e.rect.width/15,e.rect.y+7*e.rect.height/16,e.rect.x+16*e.rect.width/15,e.rect.y+13*e.rect.height/16,e.rect.x+4*e.rect.width/5,e.rect.y+13*e.rect.height/16),t.closePath(),t.fill(),t.stroke()}function Ct(t){t.anchors.push(new o(t.rect.x,t.rect.y+3*t.rect.height/5,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height/9,L.Up)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+3*t.rect.height/5,L.Right)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y+4*t.rect.height/5,L.Bottom))}function At(t){t.iconRect=new l(0,0,0,0)}function Nt(t){t.textRect=new l(t.rect.x+t.rect.width/4,t.rect.y+t.rect.height/4,t.rect.width/2,6*t.rect.height/11),t.fullTextRect=t.textRect}function zt(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y),t.lineTo(e.rect.x+e.rect.width,e.rect.y+3*e.rect.height/4),t.lineTo(e.rect.x+8*e.rect.width/16,e.rect.y+3*e.rect.height/4),t.lineTo(e.rect.x+e.rect.width/4,e.rect.ey),t.lineTo(e.rect.x+5*e.rect.width/16,e.rect.y+3*e.rect.height/4),t.lineTo(e.rect.x,e.rect.y+3*e.rect.height/4),t.closePath(),t.fill(),t.stroke()}function Dt(t){t.iconRect=new l(0,0,0,0)}function Wt(t){t.textRect=new l(t.rect.x,t.rect.y,t.rect.width,3*t.rect.height/4),t.fullTextRect=t.textRect}function Ft(t){t.anchors.push(new o(t.rect.x,t.rect.y+3*t.rect.height/8,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y,L.Up)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+3*t.rect.height/8,L.Right)),t.anchors.push(new o(t.rect.x+t.rect.width/4,t.rect.ey,L.Bottom))}function _t(t,e){t.beginPath();const i=e.rect.width/6;t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.ex-i,e.rect.y),t.lineTo(e.rect.ex,e.rect.y+i),t.lineTo(e.rect.ex,e.rect.ey),t.lineTo(e.rect.x,e.rect.ey),t.closePath(),t.moveTo(e.rect.ex-i,e.rect.y),t.lineTo(e.rect.ex-i,e.rect.y+i),t.lineTo(e.rect.ex,e.rect.y+i),t.fill(),t.stroke()}const Bt=5,Ot=30;function Ht(t){let e=t.rect.x,i=t.rect.y,r=t.rect.width;t.imageWidth&&(r=t.imageWidth,e+=(t.rect.width-r)/2);let n=t.rect.height-t.textRect.height-Bt;n<Ot&&(n=Ot);const o=Ut(t);if(o!==Ot){n=o;let e=t.rect.ey-t.textRect.y;e<0&&(e=0),i+=(t.rect.height-e-n)/2}t.iconRect=new l(e,i,r,n),t.textRect.y=t.iconRect.ey+Bt,t.textRect.ey=t.textRect.y+t.textRect.height,t.fullIconRect=t.rect}function Et(t){let e=0;const i=t.font.fontSize*t.font.lineHeight;if(t.textMaxLine)e=i*t.textMaxLine;else{e=i*m(Z.Store.get("offscreen").getContext("2d"),v(t.text),t.rect.width).length}let r=t.rect.ey-e;const n=Ut(t);r-n-Bt<t.rect.y&&(r=t.rect.y+n+Bt),t.textRect=new l(t.rect.x,r,t.rect.width,e),t.fullTextRect=t.rect}function Ut(t){let e=Ot;return t.image?t.imageHeight>0&&(e=t.imageHeight):t.icon&&t.iconSize>0&&(e=t.iconSize),e}class jt{constructor(t,e,i,r,n="",o=""){this.points=[],this.fillStyle="",this.strokeStyle="",this.points.push(t),this.points.push(e),this.points.push(i),this.points.push(r),this.fillStyle=n,this.strokeStyle=o||n}render(t){t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.beginPath();for(let e=0;e<this.points.length;++e)e?t.lineTo(this.points[e].x,this.points[e].y):t.moveTo(this.points[e].x,this.points[e].y);t.closePath(),t.fill(),t.stroke(),t.restore()}}class Yt{constructor(t,e,i,r="#ddd",n="#ccc"){this.surfaces=[];const h=e*Math.sin(45*Math.PI/180),s=new o(t.x,t.y+h),c=new o(t.ex-h,t.y+h),l=new o(t.ex-h,t.ey),d=new o(t.x,t.ey);this.surfaces.push(new jt(s,c,l,d,r,n)),this.surfaces.push(new jt(s,new o(t.x+h,t.y),new o(t.ex,t.y),c,a(.5,r),n)),this.surfaces.push(new jt(c,new o(t.ex,t.y),new o(t.ex,t.ey-h),l,a(.6,r),n))}render(t){for(const e of this.surfaces)e.render(t)}}function Xt(t,e){new Yt(e.rect,e.z,e.zRotate,e.fillStyle,e.strokeStyle).render(t)}function $t(t){const e=t.z*Math.sin(45*Math.PI/180);t.anchors.push(new o(t.rect.x,t.rect.ey-(t.rect.height-e)/2,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y+e/2,L.Up)),t.anchors.push(new o(t.rect.ex-e/2,t.rect.y+t.rect.height/2,L.Right)),t.anchors.push(new o(t.rect.x+(t.rect.width-e)/2,t.rect.y+t.rect.height,L.Bottom))}function Kt(t){t.fullIconRect=t.fullTextRect,t.iconRect=new l(t.fullIconRect.x,t.fullIconRect.y,t.fullIconRect.width,2*t.fullIconRect.height/3)}function qt(t){const e=t.z*Math.sin(45*Math.PI/180);t.fullTextRect=new l(t.rect.x,t.rect.y+e,t.rect.width-e,t.rect.height-e),t.textRect=new l(t.fullTextRect.x+10,t.fullTextRect.y+2*t.fullTextRect.height/3,t.fullTextRect.width-20,t.fullTextRect.height/3-5)}function Gt(t,e){t.beginPath();const i=e.rect.width/4,r=e.rect.x+e.rect.width/2;t.arc(r,e.rect.y+i,i,0,2*Math.PI),t.moveTo(e.rect.x,e.rect.y+3*i),t.lineTo(e.rect.ex,e.rect.y+3*i),t.moveTo(r,e.rect.y+2*i),t.lineTo(r,e.rect.y+4*i),t.moveTo(r,e.rect.y+4*i),t.lineTo(e.rect.x,e.rect.ey),t.moveTo(r,e.rect.y+4*i),t.lineTo(e.rect.ex,e.rect.ey),t.fill(),t.stroke()}function Vt(t){t.iconRect=new l(0,0,0,0)}function Jt(t){t.textRect=new l(0,0,0,0),t.fullTextRect=t.textRect}const Qt={},Zt={},te={},ee={},ie={},re={};function ne(t,e,i,r,n,o){return!(Qt[t]&&!o)&&(Qt[t]=e,ee[t]=i,Zt[t]=r,te[t]=n,!0)}console.log("Init middles."),Qt.combine=y,Qt.rectangle=y,Qt.circle=x,Zt.circle=M,te.circle=I,ee.circle=xt,Qt.triangle=f,ee.triangle=b,Zt.triangle=k,te.triangle=C,Qt.diamond=u,Zt.diamond=A,te.diamond=N,Qt.hexagon=Pt,Zt.hexagon=Lt,te.hexagon=bt,ee.hexagon=Rt,Qt.pentagon=wt,Zt.pentagon=pt,te.pentagon=vt,ee.pentagon=mt,Qt.pentagram=Tt,Zt.pentagram=Mt,te.pentagram=It,ee.pentagram=St,Qt.leftArrow=g,ee.leftArrow=T,Zt.leftArrow=z,te.leftArrow=D,Qt.rightArrow=w,ee.rightArrow=T,Zt.rightArrow=W,te.rightArrow=F,Qt.twowayArrow=p,ee.twowayArrow=T,Zt.twowayArrow=_,te.twowayArrow=B,Qt.cloud=kt,ee.cloud=Ct,Zt.cloud=At,te.cloud=Nt,Qt.message=zt,ee.message=Ft,Zt.message=Dt,te.message=Wt,Qt.file=_t,Qt.text=P,Zt.text=O,ee.text=t=>{},Qt.line=R,ee.line=S,Zt.line=O,te.line=H,Qt.image=(t,e)=>{},Zt.image=Ht,te.image=Et,Qt.cube=Xt,ee.cube=$t,Zt.cube=Kt,te.cube=qt,Qt.people=Gt,Zt.people=Vt,te.people=Jt,ie.line={drawFn:E,drawControlPointsFn:U,controlPointsFn:j,pointIn:q},ie.polyline={drawFn:X,drawControlPointsFn:$,controlPointsFn:K,dockControlPointFn:G,pointIn:q},ie.curve={drawFn:et,drawControlPointsFn:it,controlPointsFn:rt,pointIn:nt},re.triangleSolid=st,re.triangle=ct,re.diamondSolid=at,re.diamond=lt,re.circleSolid=dt,re.circle=yt,re.line=ft,re.lineUp=ut,re.lineDown=gt;class oe extends d{constructor(t){super(t),this.is3D=!1,this.zRotate=0,this.imageRatio=!0,this.anchors=[],this.rotatedAnchors=[],this.animateType=0,this.animateDuration=0,this.animateFrames=[],this.is3D=t.is3D,this.z=t.z,this.zRotate=t.zRotate||0,this.borderRadius=+t.borderRadius||0,this.borderRadius>1&&(this.borderRadius=1),this.icon=t.icon,this.iconFamily=t.iconFamily,this.iconSize=+t.iconSize,this.iconColor=t.iconColor,this.image=t.image,t.imgNaturalWidth&&(this.imgNaturalWidth=t.imgNaturalWidth),t.imgNaturalHeight&&(this.imgNaturalHeight=t.imgNaturalHeight),t.imageWidth&&(this.imageWidth=t.imageWidth),t.imageHeight&&(this.imageHeight=t.imageHeight),this.imageRatio=t.imageRatio,this.text=t.text,t.textMaxLine&&(this.textMaxLine=+t.textMaxLine||0),t.parentRect&&(this.parentRect=t.parentRect),t.animateFrames&&(this.animateFrames=t.animateFrames),t.animateDuration&&(this.animateDuration=t.animateDuration),this.animateType=t.animateType?t.animateType:t.animateDuration?"8":"",this.init(),this.setChild(t)}static cloneState(t){const e=new oe(t);return delete e.animateFrames,e}init(){var t;te[this.name]?te[this.name](this):((t=this).textRect=new l(t.rect.x+10,t.rect.y+2*t.rect.height/3,t.rect.width-20,t.rect.height/3-5),t.fullTextRect=t.rect),Zt[this.name]?Zt[this.name](this):function(t){t.iconRect=new l(t.rect.x,t.rect.y+10,t.rect.width,2*t.rect.height/3-20),t.fullIconRect=t.rect}(this),this.calcAnchors()}setChild(t){if(t.children){this.children=[];for(let e=0;e<t.children.length;++e){const i=new oe(t.children[e]);i.parentId=this.id,i.calcChildRect(this),i.init(),i.setChild(t.children[e]),this.children.push(i)}}}calcChildRect(t){this.rect=new l(t.rect.x+this.parentRect.offsetX+this.parentRect.marginX+(t.rect.width-this.parentRect.offsetX)*this.parentRect.x,t.rect.y+this.parentRect.offsetY+this.parentRect.marginY+(t.rect.height-this.parentRect.offsetY)*this.parentRect.y,(t.rect.width-this.parentRect.offsetX)*this.parentRect.width-2*this.parentRect.marginX,(t.rect.height-this.parentRect.offsetY)*this.parentRect.height-2*this.parentRect.marginY),this.parentRect.rotate||(this.parentRect.rotate=0);const e=this.rect.center.clone();e.rotate(t.rotate+t.offsetRotate,t.rect.center),this.rect.x=e.x-this.rect.width/2,this.rect.y=e.y-this.rect.height/2,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calceCenter(),this.rotate=this.parentRect.rotate+t.rotate+t.offsetRotate}draw(t){if(Qt[this.name]){if(Qt[this.name](t,this),"text"!==this.name&&this.text&&(t.save(),t.shadowColor="",t.shadowBlur=0,P(t,this),t.restore()),this.image)return this.lastImage!==this.image&&(this.img=null),this.lastImage=this.image,this.img?void this.drawImg(t):(this.img=new Image,this.img.crossOrigin="anonymous",this.img.src=this.image,void(this.img.onload=()=>{this.imgNaturalWidth=this.img.naturalWidth,this.imgNaturalHeight=this.img.naturalHeight,this.drawImg(t),this.emitRender()}));this.icon&&(t.save(),t.shadowColor="",t.shadowBlur=0,function(t,e){t.save(),t.textAlign="center",t.textBaseline="middle";const i=e.getIconRect();e.iconSize>0?t.font=`${e.iconSize}px ${e.iconFamily}`:i.width>i.height?t.font=`${i.height}px ${e.iconFamily}`:t.font=`${i.width}px ${e.iconFamily}`,e.iconColor||(e.iconColor="#2f54eb"),t.fillStyle=e.iconColor,t.beginPath(),t.fillText(e.icon,i.x+i.width/2,i.y+i.height/2),t.restore()}(t,this),t.restore())}}drawImg(t){t.save(),t.shadowColor="",t.shadowBlur=0;const e=this.getIconRect().clone(),i=e.width,r=e.height;this.imageWidth&&(e.width=this.imageWidth),this.imageHeight&&(e.height=this.imageHeight),this.imageRatio&&(this.imageWidth?e.height=this.imgNaturalHeight/this.imgNaturalWidth*e.width:e.width=this.imgNaturalWidth/this.imgNaturalHeight*e.height),"image"!==this.name&&(e.x+=(i-e.width)/2,e.y+=(r-e.height)/2),t.drawImage(this.img,e.x,e.y,e.width,e.height),t.restore()}emitRender(){Z.Store.set("render",1)}calcAnchors(){var t;this.anchors=[],ee[this.name]?ee[this.name](this):((t=this).anchors.push(new o(t.rect.x,t.rect.y+t.rect.height/2,L.Left)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y,L.Up)),t.anchors.push(new o(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,L.Right)),t.anchors.push(new o(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,L.Bottom))),this.calcRotateAnchors()}calcRotateAnchors(t){void 0===t&&(t=this.rotate),this.rotatedAnchors=[];for(const e of this.anchors)this.rotatedAnchors.push(e.clone().rotate(t,this.rect.center))}getTextRect(){let t=this.textRect;return this.icon||this.image||(t=this.fullTextRect),t}getIconRect(){let t=this.iconRect;return this.text||(t=this.fullIconRect||this.fullTextRect||this.rect),t}getDockWatchers(){this.dockWatchers=this.rect.toPoints(),this.dockWatchers.unshift(this.rect.center)}clearImg(){this.img=null}animate(t,e){let i=e-this.animateStart;if(i>this.animateDuration){if(++this.animateCycleIndex>=this.animateCycle&&this.animateCycle>0){this.animateStart=0,this.animateCycleIndex=0;const t=this.animateFrames[this.animateFrames.length-1];return this.dash=t.state.dash,this.strokeStyle=t.state.strokeStyle,this.fillStyle=t.state.fillStyle,this.font=t.state.font,this.lineWidth=t.state.lineWidth,this.rotate=t.state.rotate,this.globalAlpha=t.state.globalAlpha,t.state.rect&&t.state.rect.width&&(this.rect=new l(t.state.rect.x,t.state.rect.y,t.state.rect.width,t.state.rect.height),this.init()),void Z.Store.set("animateEnd",{type:"node",data:this})}this.animateStart=e,i=0,this.animateFrames[0].initState=oe.cloneState(this)}let r=!1;for(let t=0;t<this.animateFrames.length;++t){const e=this.animateFrames[t];if(i>=e.start&&i<e.end){this.dash=e.state.dash,this.strokeStyle=e.state.strokeStyle,this.fillStyle=e.state.fillStyle,this.font=e.state.font;const t=(i-e.start)/e.duration;e.linear?(e.state.rect.x!==e.initState.rect.x&&(this.rect.x=e.initState.rect.x+(e.state.rect.x-e.initState.rect.x)*t,r=!0),e.state.rect.y!==e.initState.rect.y&&(this.rect.y=e.initState.rect.y+(e.state.rect.y-e.initState.rect.y)*t,r=!0),e.state.rect.width!==e.initState.rect.width&&(this.rect.width=e.initState.rect.width+(e.state.rect.width-e.initState.rect.width)*t,r=!0),e.state.rect.height!==e.initState.rect.height&&(this.rect.height=e.initState.rect.height+(e.state.rect.height-e.initState.rect.height)*t,r=!0),this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calceCenter(),void 0!==e.initState.z&&e.state.z!==e.initState.z&&(this.z=e.initState.z+(e.state.z-e.initState.z)*t,r=!0),e.state.borderRadius!==e.initState.borderRadius&&(this.borderRadius=e.initState.borderRadius+(e.state.borderRadius-e.initState.borderRadius)*t),e.state.lineWidth!==e.initState.lineWidth&&(this.lineWidth=e.initState.lineWidth+(e.state.lineWidth-e.initState.lineWidth)*t),e.state.rotate!==e.initState.rotate&&(this.rotate=e.initState.rotate+(e.state.rotate-e.initState.rotate)*t,r=!0),e.state.globalAlpha!==e.initState.globalAlpha&&(this.globalAlpha=e.initState.globalAlpha+(e.state.globalAlpha-e.initState.globalAlpha)*t)):(this.rect=e.state.rect,this.lineWidth=e.state.lineWidth,this.rotate=e.state.rotate,this.globalAlpha=e.state.globalAlpha)}}r&&(this.init(),Z.Store.set("nodeMovedInAnimate",this)),this.render(t)}scale(t,e){e||(e=this.rect.center),this.rect.x=e.x-(e.x-this.rect.x)*t,this.rect.y=e.y-(e.y-this.rect.y)*t,this.rect.width*=t,this.rect.height*=t,this.imageWidth&&(this.imageWidth*=t),this.imageHeight&&(this.imageHeight*=t),this.font.fontSize*=t,this.iconSize*=t,this.rect.ex=this.rect.x+this.rect.width,this.rect.ey=this.rect.y+this.rect.height,this.rect.calceCenter(),this.init()}}class he extends d{constructor(t){if(super(t),this.controlPoints=[],this.animateColor="",this.animateSpan=1,this.animatePos=0,t){t.from&&(this.from=new o(t.from.x,t.from.y,t.from.direction,t.from.anchorIndex,t.from.id)),t.to&&(this.to=new o(t.to.x,t.to.y,t.to.direction,t.to.anchorIndex,t.to.id));for(const e of t.controlPoints)this.controlPoints.push(new o(e.x,e.y,e.direction,e.anchorIndex,e.id));this.fromArrow=t.fromArrow||"",this.toArrow=t.toArrow||"",t.animateColor&&(this.animateColor=t.animateColor),t.animateSpan&&(this.animateSpan=t.animateSpan),t.length&&(this.length=t.length)}else this.name="curve",this.fromArrow="triangleSolid"}setFrom(t,e=""){this.from=t,this.fromArrow=e}setTo(t,e="triangleSolid"){t.x=t.x,t.y=t.y,this.to=t,this.toArrow=e}calcControlPoints(){this.to&&ie[this.name]&&ie[this.name].controlPointsFn(this)}draw(t){ie[this.name]&&ie[this.name].drawFn(t,this);const e=Z.Store.get("scale");if(this.fromArrow&&re[this.fromArrow]){t.save(),t.beginPath(),this.strokeStyle?t.fillStyle=this.strokeStyle:t.fillStyle=t.strokeStyle;let i=this.to;"curve"===this.name?i=ot(.9,this.to,this.controlPoints[1],this.controlPoints[0],this.from):"line"!==this.name&&this.controlPoints.length&&(i=this.controlPoints[0]),re[this.fromArrow](t,i,this.from,e),t.restore()}if(this.toArrow&&re[this.toArrow]){t.save(),t.beginPath(),this.strokeStyle?t.fillStyle=this.strokeStyle:t.fillStyle=t.strokeStyle;let i=this.from;"curve"===this.name?i=ot(.9,this.from,this.controlPoints[0],this.controlPoints[1],this.to):"line"!==this.name&&this.controlPoints.length&&(i=this.controlPoints[this.controlPoints.length-1]),re[this.toArrow](t,i,this.to,e),t.restore()}}pointIn(t){return ie[this.name].pointIn(t,this)}getLen(){switch(this.name){case"line":return c(this.from,this.to);case"polyline":if(!this.controlPoints||!this.controlPoints.length)return c(this.from,this.to);let t=0,e=this.from;for(const i of this.controlPoints)t+=c(e,i),e=i;return 0|(t+=c(e,this.to));case"curve":return function(t,e,i,r){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",`M${t.x} ${t.y} C${e.x} ${e.y} ${i.x} ${i.y} ${r.x} ${r.y}`),0|n.getTotalLength()}(this.from,this.controlPoints[0],this.controlPoints[1],this.to)}return 0}animate(t){if(t.save(),t.lineCap="round",this.animatePos+=this.animateSpan,t.setLineDash([this.animatePos,this.length-this.animatePos+1]),this.render(t),t.restore(),this.animatePos>this.length+this.animateSpan){if(++this.animateCycleIndex>=this.animateCycle&&this.animateCycle>0)return this.animateStart=0,void Z.Store.set("animateEnd",{type:"line",data:this});this.animatePos=this.animateSpan}}}class se{constructor(t={}){this.options=t,this.canvas=document.createElement("canvas"),this.nodes=Z.Store.get("nodes"),this.lines=Z.Store.get("lines"),this.rendering=!1,this.canvas.style.outline="none"}resize(t,e){this.canvas.width=t,this.canvas.height=e}render(){if(this.rendering)return;this.rendering=!0,this.canvas.height=this.canvas.height;const t=this.canvas.getContext("2d");t.strokeStyle=this.options.color,t.fillStyle="#fff",this.renderNodes(),this.renderLines(),Z.Store.set("render",1),this.rendering=!1}renderNodes(){if(!this.nodes.length)return;const t=this.canvas.getContext("2d");for(const e of this.nodes)e.animateStart&&e.animateDuration||e.render(t)}renderLines(){if(!this.lines.length)return;const t=this.canvas.getContext("2d");let e=0;for(const i of this.lines)i.to?(i.render(t),++e):this.lines.splice(e++,1)}}class ce{constructor(t,e){this.options=e,this.canvas=document.createElement("canvas"),this.anchorRadius=4,this.hoverAnchorIndex=-1,this.dockLineX=0,this.dockLineY=0,this.options.hoverColor||(this.options.hoverColor="#d4380d"),this.options.dragColor||(this.options.dragColor="#d4380d"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.outline="none",t.appendChild(this.canvas)}setLine(t,e="",i="curve"){this.line=new he,this.line.name=i,this.line.setFrom(t,e),Z.Store.get("lines").push(this.line)}lineTo(t,e="triangleSolid"){this.line.setTo(t,e),this.line.calcControlPoints()}lineFrom(t){this.line.setFrom(t,this.line.fromArrow),this.line.calcControlPoints()}lineMove(t,e){const i=t.x-e.x,r=t.y-e.y;this.line.setTo(new o(this.initLine.to.x+i,this.initLine.to.y+r),this.line.toArrow),this.line.setFrom(new o(this.initLine.from.x+i,this.initLine.from.y+r),this.line.fromArrow),this.line.calcControlPoints()}render(){this.canvas.height=this.canvas.height;const t=this.canvas.getContext("2d");if(t.translate(0,0),t.strokeStyle=this.options.hoverColor,t.fillStyle="#fff",this.node)for(let e=0;e<this.node.rotatedAnchors.length;++e)this.node.rotatedAnchors[e].hidden&&this.hoverAnchorIndex!==e||(t.beginPath(),t.arc(this.node.rotatedAnchors[e].x,this.node.rotatedAnchors[e].y,this.anchorRadius,0,2*Math.PI),t.fill(),t.stroke());const e=Z.Store.get("activeLine");e&&ie[e.name].drawControlPointsFn(t,e),t.fillStyle=this.options.hoverColor,this.dockAnchor&&(t.beginPath(),t.arc(this.dockAnchor.x,this.dockAnchor.y,4,0,2*Math.PI),t.fill()),this.hoverLineCP&&(t.beginPath(),t.arc(this.hoverLineCP.x,this.hoverLineCP.y,5,0,2*Math.PI),t.fill()),t.strokeStyle=this.options.dragColor+"50",t.fillStyle=this.options.dragColor+"30",t.lineWidth=1,t.translate(.5,.5),this.dockLineX>0&&(t.beginPath(),t.moveTo(this.dockLineX,0),t.lineTo(this.dockLineX,this.canvas.height),t.stroke()),this.dockLineY>0&&(t.beginPath(),t.moveTo(0,this.dockLineY),t.lineTo(this.canvas.width,this.dockLineY),t.stroke()),this.dragRect&&(t.strokeStyle=this.options.dragColor,t.beginPath(),t.strokeRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height),t.fillRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height))}resize(t,e){this.canvas.width=t,this.canvas.height=e}}class ae{constructor(t,e){this.options=e,this.canvas=document.createElement("canvas"),this.rotateCPs=[],this.sizeCPs=[],this.nodes=[],this.lines=[],this.rotate=0,this.initialSizeCPs=[],this.nodeRects=[],this.childrenRects={},this.dockWatchers=[],this.rotating=!1,this.options.activeColor||(this.options.activeColor="#d4380d"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.outline="none",t.appendChild(this.canvas)}calcControlPoints(){if(1===this.nodes.length){if(this.rect=this.nodes[0].rect,this.sizeCPs=this.nodes[0].rect.toPoints(),this.rotateCPs=[new o(this.nodes[0].rect.x+this.nodes[0].rect.width/2,this.nodes[0].rect.y-35),new o(this.nodes[0].rect.x+this.nodes[0].rect.width/2,this.nodes[0].rect.y)],this.rotate||this.nodes[0].rotate){for(const t of this.sizeCPs)this.nodes[0].rotate&&t.rotate(this.nodes[0].rotate,this.nodes[0].rect.center),this.rotate&&t.rotate(this.rotate,this.rect.center);for(const t of this.rotateCPs)this.nodes[0].rotate&&t.rotate(this.nodes[0].rotate,this.nodes[0].rect.center),this.rotate&&t.rotate(this.rotate,this.rect.center)}return void(this.options.hideRotateCP&&(this.rotateCPs=[new o(-1e3,-1e3),new o(-1e3,-1e3)]))}let t=99999,e=99999,i=-99999,r=-99999;const n=this.getPoints();for(const o of n)t>o.x&&(t=o.x),e>o.y&&(e=o.y),i<o.x&&(i=o.x),r<o.y&&(r=o.y);this.rect=new l(t,e,i-t,r-e),this.sizeCPs=[new o(t,e),new o(i,e),new o(i,r),new o(t,r)],this.rotateCPs=[new o(t+(i-t)/2,e-35),new o(t+(i-t)/2,e)],this.options.hideRotateCP&&(this.rotateCPs=[new o(-1e3,-1e3),new o(-1e3,-1e3)])}getPoints(){const t=[];for(const e of this.nodes){const i=e.rect.toPoints();if(e.rotate)for(const t of i)t.rotate(e.rotate,e.rect.center);t.push.apply(t,i)}return t}render(){if(this.canvas.height=this.canvas.height,!this.nodes.length&&!this.lines.length)return;1!==this.nodes.length&&this.rotating||this.calcControlPoints();const t=this.canvas.getContext("2d");if(t.strokeStyle=this.options.activeColor,t.fillStyle="#fff",t.lineWidth=1,this.renderNodesLines(),this.rotate&&this.nodes.length>1&&(t.translate(this.rect.center.x,this.rect.center.y),t.rotate(this.rotate*Math.PI/180),t.translate(-this.rect.center.x,-this.rect.center.y)),t.save(),t.globalAlpha=.3,t.beginPath(),t.moveTo(this.sizeCPs[0].x-.5,this.sizeCPs[0].y-.5),t.lineTo(this.sizeCPs[1].x+.5,this.sizeCPs[1].y-.5),t.lineTo(this.sizeCPs[2].x+.5,this.sizeCPs[2].y+.5),t.lineTo(this.sizeCPs[3].x-.5,this.sizeCPs[3].y-.5),t.closePath(),t.stroke(),t.restore(),!Z.Store.get("locked")){t.beginPath(),t.moveTo(this.rotateCPs[0].x,this.rotateCPs[0].y),t.lineTo(this.rotateCPs[1].x,this.rotateCPs[1].y),t.stroke(),t.beginPath(),t.arc(this.rotateCPs[0].x,this.rotateCPs[0].y,5,0,2*Math.PI),t.fill(),t.stroke(),t.lineWidth=1;for(const e of this.sizeCPs)t.save(),t.beginPath(),1===this.nodes.length&&(this.nodes[0].rotate||this.rotate)&&(t.translate(e.x,e.y),t.rotate((this.nodes[0].rotate+this.rotate)*Math.PI/180),t.translate(-e.x,-e.y)),t.fillRect(e.x-4.5,e.y-4.5,8,8),t.strokeRect(e.x-5.5,e.y-5.5,10,10),t.restore()}}saveNodeRects(){this.nodeRects=[],this.childrenRects={};for(const t of this.nodes)this.nodeRects.push(new l(t.rect.x,t.rect.y,t.rect.width,t.rect.height)),this.saveChildrenRects(t);this.initialSizeCPs=[];for(const t of this.sizeCPs){const e=t.clone();1===this.nodes.length&&this.nodes[0].rotate&&e.rotate(-this.nodes[0].rotate,this.nodes[0].rect.center),this.initialSizeCPs.push(e)}this.getDockWatchers()}saveChildrenRects(t){if(t.children)for(const e of t.children)this.childrenRects[e.id]=new l(e.rect.x,e.rect.y,e.rect.width,e.rect.height),this.saveChildrenRects(e)}resizeNodes(t,e){let i=0;const r=new o(0,0);let n,h,s,c;for(const o of this.nodes){switch(t){case 0:n=e.x,h=e.y,s=this.initialSizeCPs[2].x-e.x,c=this.initialSizeCPs[2].y-e.y,r.x=s>5?n:this.initialSizeCPs[2].x-5,r.y=c>5?h:this.initialSizeCPs[2].y-5;break;case 1:h=e.y,s=e.x-this.initialSizeCPs[0].x,c=this.initialSizeCPs[2].y-e.y,r.x=this.initialSizeCPs[0].x,r.y=c>5?h:this.initialSizeCPs[2].y-5;break;case 2:s=e.x-this.initialSizeCPs[0].x,c=e.y-this.initialSizeCPs[0].y,r.x=this.initialSizeCPs[0].x,r.y=this.initialSizeCPs[0].y;break;case 3:n=e.x,s=this.initialSizeCPs[2].x-e.x,c=e.y-this.initialSizeCPs[0].y,r.x=s>5?n:this.initialSizeCPs[2].x-5,r.y=this.initialSizeCPs[0].y}s=s>5?s:5,c=c>5?c:5,this.calcResizedPos(o.rect,this.nodeRects[i],r,s/(this.initialSizeCPs[2].x-this.initialSizeCPs[0].x),c/(this.initialSizeCPs[2].y-this.initialSizeCPs[0].y)),o.rect.calceCenter(),o.init(),this.updateChildren(o),++i}this.updateLines()}calcResizedPos(t,e,i,r,n){t.x=i.x+(e.x-this.initialSizeCPs[0].x)*r,t.y=i.y+(e.y-this.initialSizeCPs[0].y)*n,t.width=e.width*r,t.height=e.height*n,t.ex=t.x+t.width,t.ey=t.y+t.height}moveNodes(t,e){if(this.nodeRects.length!==this.nodes.length)return;let i=0;for(const r of this.nodes)r.rect.x=this.nodeRects[i].x+t,r.rect.y=this.nodeRects[i].y+e,r.rect.ex=r.rect.x+r.rect.width,r.rect.ey=r.rect.y+r.rect.height,r.rect.calceCenter(),r.init(),this.updateChildren(r),++i;this.updateLines()}updateChildren(t){if(t.children)for(const e of t.children)e.calcChildRect(t),e.init(),this.updateChildren(e)}updateLines(t){t||(t=this.nodes);const e=Z.Store.get("lines");for(const i of e){let e=!1;for(const r of t)i.from.id===r.id&&(i.from.x=r.rotatedAnchors[i.from.anchorIndex].x,i.from.y=r.rotatedAnchors[i.from.anchorIndex].y,e=!0),i.to.id===r.id&&(i.to.x=r.rotatedAnchors[i.to.anchorIndex].x,i.to.y=r.rotatedAnchors[i.to.anchorIndex].y,e=!0),r.children&&this.updateLines(r.children);e&&i.calcControlPoints()}}changeLineType(){for(const t of this.lines)t.calcControlPoints()}offsetRotate(t){this.rotating=!0;let e=0;for(const i of this.nodes){const r=this.nodeRects[e].center.clone();this.nodes.length>1&&r.rotate(t,this.rect.center),i.rect.x=r.x-i.rect.width/2,i.rect.y=r.y-i.rect.height/2,i.rect.ex=i.rect.x+i.rect.width,i.rect.ey=i.rect.y+i.rect.height,i.rect.calceCenter(),i.init(),i.offsetRotate=t,i.calcRotateAnchors(i.rotate+i.offsetRotate),this.updateChildren(i),++e}this.rotate=t}updateRotate(){for(const t of this.nodes)t.rotate+=t.offsetRotate,t.offsetRotate=0;this.rotate=0,this.rotating=!1}addNode(t){this.nodes.push(t)}setNodes(t){this.nodes=t,this.lines=[]}hasNode(t){let e=!1;for(const i of this.nodes)if(i.id===t.id){e=!0;break}return e}renderNodesLines(){const t=this.canvas.getContext("2d");t.save();for(const e of this.nodes){const i=new oe(e);i.fillStyle=null,i.icon="",i.image="",i.text="",i.children=null,"transparent"!==i.strokeStyle&&(i.strokeStyle="#ffffff",i.lineWidth+=2,i.render(t),i.strokeStyle="#d4380d",i.lineWidth-=2),i.render(t)}for(const e of this.lines){if(!e.to)continue;const i=new he(e);i.strokeStyle="#ffffff",i.lineWidth+=2,i.render(t),i.strokeStyle="#d4380d",i.lineWidth-=2,i.render(t)}t.restore()}resize(t,e){this.canvas.width=t,this.canvas.height=e}updateProps(t,e,i){if(t){for(const e of t)e.rect.ex=e.rect.x+e.rect.width,e.rect.ey=e.rect.y+e.rect.height,e.rect.calceCenter(),e.init(),e.dash=i.dash,e.lineWidth=i.lineWidth,e.strokeStyle=i.strokeStyle,e.fillStyle=i.fillStyle,e.globalAlpha=i.globalAlpha;this.updateLines(t)}if(e)for(const t of e)t.dash=i.dash,t.lineWidth=i.lineWidth,t.strokeStyle=i.strokeStyle,t.fillStyle=i.fillStyle,t.globalAlpha=i.globalAlpha;this.calcControlPoints()}getDockWatchers(){if(1===this.nodes.length)return this.dockWatchers=this.nodeRects[0].toPoints(),void this.dockWatchers.unshift(this.nodeRects[0].center);this.dockWatchers=this.rect.toPoints(),this.dockWatchers.unshift(this.rect.center)}}class le{constructor(t,e){this.options=e,this.canvas=document.createElement("canvas"),this.nodes=[],this.lines=[],this.last=Date.now(),this.options.animateColor||(this.options.animateColor="#ff6600"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.outline="none",t.appendChild(this.canvas)}render(t=!0){this.timer&&cancelAnimationFrame(this.timer),t&&(this.nodes=[],this.lines=[]);const e=Z.Store.get("nodes"),i=Z.Store.get("lines");for(const t of e){let e=!1;for(let i=0;i<this.nodes.length;++i)this.nodes[i].id===t.id&&(t.animateCycleIndex=1,e=!0,t.animateStart||this.nodes.splice(i,1));!e&&t.animateStart&&this.addNode(t)}for(const t of i){let e=!1;for(let i=0;i<this.lines.length;++i)this.lines[i].id===t.id&&(this.lines[i].animateCycle=t.animateCycle,this.lines[i].animateCycleIndex=1,this.lines[i].animateColor=t.animateColor||this.options.animateColor,this.lines[i].strokeStyle=t.animateColor||this.options.animateColor,this.lines[i].animateSpan=t.animateSpan,e=!0,t.animateStart?this.lines[i].animateStart=t.animateStart:this.lines.splice(i,1));!e&&t.animateStart&&this.addLine(t)}this.animate()}addNode(t){let e=0;for(let i=0;i<t.animateFrames.length;++i)t.animateFrames[i].start=e,e+=t.animateFrames[i].duration,t.animateFrames[i].end=e,t.animateFrames[i].initState=oe.cloneState(i?t.animateFrames[i-1].state:t);this.nodes.push(t)}addLine(t){const e=new he(t);e.fromArrow="",e.toArrow="",e.lineWidth+=1,e.strokeStyle=e.animateColor||this.options.animateColor,e.length=e.getLen(),e.animateStart=t.animateStart,this.lines.push(e)}animate(){if(!this.lines.length&&!this.nodes.length)return this.canvas.height=this.canvas.height,void(this.timer=null);this.timer=requestAnimationFrame(()=>{const t=Date.now(),e=t-this.last;if(this.last=t,e>15){this.canvas.height=this.canvas.height;const e=this.canvas.getContext("2d");for(let t=0;t<this.lines.length;++t)this.lines[t].animate(e),this.lines[t]&&!this.lines[t].animateStart&&this.lines.splice(t,1);for(let i=0;i<this.nodes.length;++i)this.nodes[i].animateDuration&&this.nodes[i].animateStart?this.nodes[i].animate(e,t):this.nodes.splice(i,1)}this.animate()})}resize(t,e){this.canvas.width=t,this.canvas.height=e}}const de=["nw-resize","ne-resize","se-resize","sw-resize"];var ye;!function(t){t[t.None=0]="None",t[t.Line=1]="Line",t[t.LineMove=2]="LineMove",t[t.LineFrom=3]="LineFrom",t[t.LineTo=4]="LineTo",t[t.LineControlPoint=5]="LineControlPoint",t[t.Nodes=6]="Nodes",t[t.ResizeCP=7]="ResizeCP",t[t.HoverAnchors=8]="HoverAnchors",t[t.Rotate=9]="Rotate"}(ye||(ye={}));const xe=10;var fe=i(11);var ue=i(1),ge=i(2);var we=i(3);var pe=i(5);function ve(t,e){const i=e.rect.width*e.borderRadius,r=e.rect.height*e.borderRadius;let n=i<r?i:r;e.rect.width<2*n&&(n=e.rect.width/2),e.rect.height<2*n&&(n=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+n,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,n),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,n),t.closePath(),t.fill(),t.stroke()}function me(t){t.iconRect=new pe.Rect(0,0,0,0)}function Pe(t){t.textRect=new pe.Rect(t.rect.x,t.rect.y,t.rect.width,t.rect.height),t.fullTextRect=t.textRect}var Re=i(6),Le=i(8);var be=i(10);var Te=i(9);var Se=i(4),Me=i(7);ne("flowData",(function(t,e){t.beginPath();const i=e.rect.width/7;t.moveTo(e.rect.x+i,e.rect.y),t.lineTo(e.rect.ex,e.rect.y),t.lineTo(e.rect.x+e.rect.width-i,e.rect.ey),t.lineTo(e.rect.x,e.rect.ey),t.closePath(),t.fill(),t.stroke()}),(function(t){t.anchors.push(new ue.Point(t.rect.x+t.rect.width/14,t.rect.y+t.rect.height/2,ge.Direction.Left)),t.anchors.push(new ue.Point(t.rect.x+4*t.rect.width/7,t.rect.y,ge.Direction.Up)),t.anchors.push(new ue.Point(t.rect.x+13*t.rect.width/14,t.rect.y+t.rect.height/2,ge.Direction.Right)),t.anchors.push(new ue.Point(t.rect.x+3*t.rect.width/7,t.rect.ey,ge.Direction.Bottom))}),(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){t.textRect=new we.Rect(t.rect.x+t.rect.width/7,t.rect.y,5*t.rect.width/7,t.rect.height),t.fullTextRect=t.textRect})),ne("flowSubprocess",(function(t,e){t.beginPath();const i=e.rect.width/7;t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.ex,e.rect.y),t.lineTo(e.rect.ex,e.rect.ey),t.lineTo(e.rect.x,e.rect.ey),t.closePath(),t.moveTo(e.rect.x+i,e.rect.y),t.lineTo(e.rect.x+i,e.rect.ey),t.moveTo(e.rect.ex-i,e.rect.y),t.lineTo(e.rect.ex-i,e.rect.ey),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){t.textRect=new we.Rect(t.rect.x+t.rect.width/7,t.rect.y,5*t.rect.width/7,t.rect.height),t.fullTextRect=t.textRect})),ne("flowDb",(function(t,e){t.beginPath();const i=e.rect.height/7;t.moveTo(e.rect.x,e.rect.y+i),t.bezierCurveTo(e.rect.x,e.rect.y-i/2|0,e.rect.ex,e.rect.y-i/2|0,e.rect.ex,e.rect.y+i),t.lineTo(e.rect.ex,e.rect.ey-i),t.bezierCurveTo(e.rect.ex,e.rect.ey+i/2|0,e.rect.x,e.rect.ey+i/2|0,e.rect.x,e.rect.ey-i),t.closePath(),t.moveTo(e.rect.x,e.rect.ey-i),t.bezierCurveTo(e.rect.x,e.rect.ey-2*i|0,e.rect.ex,e.rect.ey-2*i|0,e.rect.ex,e.rect.ey-i),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){t.textRect=new we.Rect(t.rect.x,t.rect.y+t.rect.height/8,t.rect.width,5*t.rect.height/8),t.fullTextRect=t.textRect})),ne("flowDocument",(function(t,e){t.beginPath();const i=e.rect.x+e.rect.width/2,r=e.rect.y+6*e.rect.height/7,n=e.rect.height/6;t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.ex,e.rect.y),t.lineTo(e.rect.ex,r),t.bezierCurveTo(e.rect.ex-20,r-n,i+e.rect.width/5,r-n,i,r),t.bezierCurveTo(i-e.rect.width/5,r+n,e.rect.x,r+n,e.rect.x,r),t.closePath(),t.fill(),t.stroke()}),(function(t){t.anchors.push(new ue.Point(t.rect.x,t.rect.y+t.rect.height/2,ge.Direction.Left)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.y,ge.Direction.Up)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,ge.Direction.Right)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.y+6*t.rect.height/7,ge.Direction.Bottom))}),(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){t.textRect=new we.Rect(t.rect.x,t.rect.y,t.rect.width,5*t.rect.height/7),t.fullTextRect=t.textRect})),ne("flowInternalStorage",(function(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.ex,e.rect.y),t.lineTo(e.rect.ex,e.rect.ey),t.lineTo(e.rect.x,e.rect.ey),t.closePath();const i=e.rect.width/7;t.moveTo(e.rect.x,e.rect.y+i),t.lineTo(e.rect.ex,e.rect.y+i),t.moveTo(e.rect.x+i,e.rect.y),t.lineTo(e.rect.x+i,e.rect.ey),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){const e=t.rect.width/7;t.textRect=new we.Rect(t.rect.x+e,t.rect.y+e,t.rect.width-e,t.rect.height-e),t.fullTextRect=t.textRect})),ne("flowExternStorage",(function(t,e){t.beginPath();const i=e.rect.width/10;t.moveTo(e.rect.x+2*i,e.rect.y),t.bezierCurveTo(e.rect.x-2*i/3,e.rect.y,e.rect.x-2*i/3,e.rect.ey,e.rect.x+2*i,e.rect.ey),t.lineTo(e.rect.ex,e.rect.ey),t.bezierCurveTo(e.rect.ex-i,e.rect.ey,e.rect.ex-i,e.rect.y,e.rect.ex,e.rect.y),t.closePath(),t.fill(),t.stroke()}),(function(t){t.anchors.push(new ue.Point(t.rect.x,t.rect.y+t.rect.height/2,ge.Direction.Left)),t.anchors.push(new ue.Point(t.rect.x+8*t.rect.width/15,t.rect.y,ge.Direction.Up)),t.anchors.push(new ue.Point(t.rect.x+13*t.rect.width/14,t.rect.y+t.rect.height/2,ge.Direction.Right)),t.anchors.push(new ue.Point(t.rect.x+8*t.rect.width/15,t.rect.ey,ge.Direction.Bottom))}),(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){t.textRect=new we.Rect(t.rect.x+t.rect.width/6,t.rect.y,3*t.rect.width/4,t.rect.height),t.fullTextRect=t.textRect})),ne("flowQueue",(function(t,e){t.beginPath(),t.ellipse(e.rect.x+e.rect.width/2,e.rect.y+e.rect.height/2,e.rect.width/2,e.rect.height/2,0,0,2*Math.PI),t.moveTo(e.rect.x+e.rect.width/2,e.rect.ey),t.lineTo(e.rect.ex,e.rect.ey),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){const e=5*t.rect.width/7,i=5*t.rect.height/7;t.textRect=new we.Rect(t.rect.x+(t.rect.width-e)/2,t.rect.y+(t.rect.height-i)/2,e,i),t.fullTextRect=t.textRect})),ne("flowManually",(function(t,e){t.beginPath();const i=e.rect.height/4;t.moveTo(e.rect.x,e.rect.y+i),t.lineTo(e.rect.ex,e.rect.y),t.lineTo(e.rect.ex,e.rect.ey),t.lineTo(e.rect.x,e.rect.ey),t.closePath(),t.fill(),t.stroke()}),(function(t){t.anchors.push(new ue.Point(t.rect.x,t.rect.y+5*t.rect.height/8,ge.Direction.Left)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height/8,ge.Direction.Up)),t.anchors.push(new ue.Point(t.rect.ex,t.rect.y+t.rect.height/2,ge.Direction.Right)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.ey,ge.Direction.Bottom))}),(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){t.textRect=new we.Rect(t.rect.x,t.rect.y+t.rect.height/4,t.rect.width,3*t.rect.height/4),t.fullTextRect=t.textRect})),ne("flowDisplay",(function(t,e){t.beginPath();const i=e.rect.width/8;t.moveTo(e.rect.x+i,e.rect.y),t.lineTo(e.rect.ex-i,e.rect.y),t.bezierCurveTo(e.rect.ex+i/3,e.rect.y,e.rect.ex+i/3,e.rect.ey,e.rect.ex-i,e.rect.ey),t.lineTo(e.rect.x+i,e.rect.ey),t.lineTo(e.rect.x,e.rect.y+e.rect.height/2),t.closePath(),t.fill(),t.stroke()}),(function(t){t.anchors.push(new ue.Point(t.rect.x,t.rect.y+t.rect.height/2,ge.Direction.Left)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.y,ge.Direction.Up)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width,t.rect.y+t.rect.height/2,ge.Direction.Right)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,ge.Direction.Bottom))}),(function(t){t.iconRect=new we.Rect(0,0,0,0)}),(function(t){t.textRect=new we.Rect(t.rect.x+t.rect.width/8,t.rect.y,3*t.rect.width/4,t.rect.height),t.fullTextRect=t.textRect})),ne("flowParallel",(function(t,e){t.beginPath(),t.moveTo(e.rect.x,e.rect.y),t.lineTo(e.rect.ex,e.rect.y),t.moveTo(e.rect.x,e.rect.ey),t.lineTo(e.rect.ex,e.rect.ey),t.fill(),t.stroke()}),(function(t){t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.y,ge.Direction.Up)),t.anchors.push(new ue.Point(t.rect.x+t.rect.width/2,t.rect.y+t.rect.height,ge.Direction.Bottom))}),null,null),ne("flowComment",(function(t,e){t.beginPath();const i=e.rect.width/4;t.moveTo(e.rect.x+i,e.rect.y),t.lineTo(e.rect.x,e.rect.y),t.lineTo(e.rect.x,e.rect.ey),t.lineTo(e.rect.x+i,e.rect.ey),t.fill(),t.stroke()}),(function(t){t.anchors.push(new ue.Point(t.rect.x,t.rect.y+t.rect.height/2,ge.Direction.Left))}),null,null),ne("activityFinal",(function(t,e){t.beginPath(),t.ellipse(e.rect.x+e.rect.width/2,e.rect.y+e.rect.height/2,e.rect.width/2,e.rect.height/2,0,0,2*Math.PI),t.stroke(),t.beginPath(),t.fillStyle=t.strokeStyle,t.ellipse(e.rect.x+e.rect.width/2,e.rect.y+e.rect.height/2,e.rect.width/4,e.rect.height/4,0,0,2*Math.PI),t.fill()}),null,(function(t){t.iconRect=new pe.Rect(0,0,0,0)}),(function(t){const e=5*t.rect.width/7,i=5*t.rect.height/7;t.textRect=new pe.Rect(t.rect.x+(t.rect.width-e)/2,t.rect.y+(t.rect.height-i)/2,e,i),t.fullTextRect=t.textRect})),ne("swimlaneV",(function(t,e){const i=e.rect.width*e.borderRadius,r=e.rect.height*e.borderRadius;let n=i<r?i:r;e.rect.width<2*n&&(n=e.rect.width/2),e.rect.height<2*n&&(n=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+n,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,n),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,n),t.closePath(),t.moveTo(e.rect.x,e.rect.y+40),t.lineTo(e.rect.ex,e.rect.y+40),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new pe.Rect(0,0,0,0)}),(function(t){t.textRect=new pe.Rect(t.rect.x,t.rect.y,t.rect.width,40),t.fullTextRect=t.textRect})),ne("swimlaneH",(function(t,e){const i=e.rect.width*e.borderRadius,r=e.rect.height*e.borderRadius;let n=i<r?i:r;e.rect.width<2*n&&(n=e.rect.width/2),e.rect.height<2*n&&(n=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+n,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,n),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,n),t.closePath(),t.moveTo(e.rect.x+40,e.rect.y),t.lineTo(e.rect.x+40,e.rect.ey),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new pe.Rect(0,0,0,0)}),(function(t){t.textRect=new pe.Rect(t.rect.x+10,t.rect.y,20,t.rect.height),t.fullTextRect=t.textRect})),ne("forkH",ve,(function(t){t.anchors.push(new Re.Point(t.rect.x,t.rect.y+t.rect.height/2,Le.Direction.Left)),t.anchors.push(new Re.Point(t.rect.ex,t.rect.y+t.rect.height/2,Le.Direction.Right));for(let e=25;t.rect.x+e<t.rect.ex;e+=25){const i=new Re.Point(t.rect.x+e,t.rect.y,Le.Direction.Up),r=new Re.Point(t.rect.x+e,t.rect.ey,Le.Direction.Bottom);i.hidden=!0,r.hidden=!0,t.anchors.push(i),t.anchors.push(r)}}),me,Pe),ne("forkV",ve,(function(t){t.anchors.push(new Re.Point(t.rect.x+t.rect.width/2,t.rect.y,Le.Direction.Up)),t.anchors.push(new Re.Point(t.rect.x+t.rect.width/2,t.rect.ey,Le.Direction.Bottom));for(let e=25;t.rect.y+e<t.rect.ey;e+=25){const i=new Re.Point(t.rect.x,t.rect.y+e,Le.Direction.Left),r=new Re.Point(t.rect.ex,t.rect.y+e,Le.Direction.Right);i.hidden=!0,r.hidden=!0,t.anchors.push(i),t.anchors.push(r)}}),me,Pe),ne("simpleClass",(function(t,e){const i=e.rect.width*e.borderRadius,r=e.rect.height*e.borderRadius;let n=i<r?i:r;e.rect.width<2*n&&(n=e.rect.width/2),e.rect.height<2*n&&(n=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+n,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,n),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,n),t.closePath(),t.moveTo(e.rect.x,e.rect.y+40),t.lineTo(e.rect.ex,e.rect.y+40),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new be.Rect(0,0,0,0)}),(function(t){t.textRect=new be.Rect(t.rect.x,t.rect.y,t.rect.width,40),t.fullTextRect=t.textRect})),ne("interfaceClass",(function(t,e){const i=e.rect.width*e.borderRadius,r=e.rect.height*e.borderRadius;let n=i<r?i:r;e.rect.width<2*n&&(n=e.rect.width/2),e.rect.height<2*n&&(n=e.rect.height/2),t.beginPath(),t.moveTo(e.rect.x+n,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x+e.rect.width,e.rect.y+e.rect.height,e.rect.x,e.rect.y+e.rect.height,n),t.arcTo(e.rect.x,e.rect.y+e.rect.height,e.rect.x,e.rect.y,n),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,n),t.closePath(),t.moveTo(e.rect.x,e.rect.y+40),t.lineTo(e.rect.ex,e.rect.y+40);const o=e.rect.y+20+e.rect.height/2;t.moveTo(e.rect.x,o),t.lineTo(e.rect.ex,o),t.fill(),t.stroke()}),null,(function(t){t.iconRect=new be.Rect(0,0,0,0)}),(function(t){t.textRect=new be.Rect(t.rect.x,t.rect.y,t.rect.width,40),t.fullTextRect=t.textRect})),ne("lifeline",(function(t,e){const i=e.rect.width*e.borderRadius,r=50*e.borderRadius;let n=i<r?i:r;e.rect.width<2*n&&(n=e.rect.width/2),50<2*n&&(n=25),t.beginPath(),t.moveTo(e.rect.x+n,e.rect.y),t.arcTo(e.rect.x+e.rect.width,e.rect.y,e.rect.x+e.rect.width,e.rect.y+50,n),t.arcTo(e.rect.x+e.rect.width,e.rect.y+50,e.rect.x,e.rect.y+50,n),t.arcTo(e.rect.x,e.rect.y+50,e.rect.x,e.rect.y,n),t.arcTo(e.rect.x,e.rect.y,e.rect.x+e.rect.width,e.rect.y,n),t.closePath(),t.fill(),t.stroke(),t.save(),t.beginPath(),t.lineWidth=1,t.setLineDash([7,7]);const o=e.rect.x+e.rect.width/2;t.moveTo(o,e.rect.y+50+1),t.lineTo(o,e.rect.ey),t.stroke(),t.restore()}),(function(t){t.anchors.push(new Se.Point(t.rect.x,t.rect.y+25,Me.Direction.Left)),t.anchors.push(new Se.Point(t.rect.x+t.rect.width/2,t.rect.y,Me.Direction.Up)),t.anchors.push(new Se.Point(t.rect.x+t.rect.width,t.rect.y+25,Me.Direction.Right)),t.anchors.push(new Se.Point(t.rect.x+t.rect.width/2,t.rect.y+50,Me.Direction.Bottom)),t.anchors.push(new Se.Point(t.rect.x+t.rect.width/2,t.rect.ey,Me.Direction.Bottom))}),(function(t){t.iconRect=new Te.Rect(0,0,0,0)}),(function(t){t.textRect=new Te.Rect(t.rect.x,t.rect.y,t.rect.width,50),t.fullTextRect=t.textRect})),ne("sequenceFocus",(function(t,e){t.beginPath(),t.rect(e.rect.x,e.rect.y,e.rect.width,e.rect.height),this.fillStyle?t.fillStyle=this.fillStyle:t.fillStyle="#fff",t.fill(),t.stroke()}),(function(t){t.anchors.push(new Se.Point(t.rect.x+t.rect.width/2,t.rect.y,Me.Direction.Up)),t.anchors.push(new Se.Point(t.rect.x+t.rect.width/2,t.rect.ey,Me.Direction.Bottom));for(let e=25;t.rect.y+e<t.rect.ey;e+=25){const i=new Se.Point(t.rect.x,t.rect.y+e,Me.Direction.Left),r=new Se.Point(t.rect.ex,t.rect.y+e,Me.Direction.Right);i.hidden=!0,r.hidden=!0,t.anchors.push(i),t.anchors.push(r)}}),(function(t){t.iconRect=new Te.Rect(0,0,0,0)}),(function(t){t.textRect=new Te.Rect(0,0,0,0),t.fullTextRect=t.textRect})),window.Le5leTopology={Topology:class{constructor(t,e){this.canvas=document.createElement("canvas"),this.nodes=[],this.lines=[],this.scaleState=1,this.input=document.createElement("textarea"),this.lastTranlated={x:0,y:0},this.moveIn={type:ye.None,activeAnchorIndex:0,hoverAnchorIndex:0,hoverNode:null,hoverLine:null,lineControlPoint:null},this.nodesMoved=!1,this.fromArrowType="",this.toArrowType="triangleSolid",this.lineName="curve",this.locked=0,this.scheduledAnimationFrame=!1,this.caches={index:0,list:[]},this.onMouseMove=t=>{if(this.scheduledAnimationFrame)return;if(t.altKey&&this.mouseDown)return void this.translate(t.offsetX-this.mouseDown.x,t.offsetY-this.mouseDown.y);if(this.locked<0)return;this.scheduledAnimationFrame=!0;const e=new o(t.offsetX,t.offsetY);requestAnimationFrame(()=>{if(this.scheduledAnimationFrame=!1,!this.mouseDown)return this.getMoveIn(e),this.moveIn.hoverNode?(this.hoverLayer.node=this.moveIn.hoverNode,this.hoverLayer.render(),!this.lastHoverNode&&this.options.on&&this.options.on("moveInNode",this.moveIn.hoverNode)):this.lastHoverNode&&(this.hoverLayer.node=null,this.hoverLayer.canvas.height=this.hoverLayer.canvas.height,this.options.on&&this.options.on("moveOutNode",null)),void(this.moveIn.type===ye.LineControlPoint?(this.hoverLayer.hoverLineCP=this.moveIn.lineControlPoint,this.hoverLayer.render()):this.hoverLayer.hoverLineCP&&(this.hoverLayer.hoverLineCP=null,this.hoverLayer.render()));(e.x+50>this.parentElem.clientWidth+this.parentElem.scrollLeft||e.y+50>this.parentElem.clientHeight+this.parentElem.scrollTop)&&this.options.on&&this.options.on("moveOutParent",e);const t=e.x+50>this.hoverLayer.canvas.width||e.y+50>this.hoverLayer.canvas.height;switch(t&&(e.x+50>this.hoverLayer.canvas.width&&(this.canvas.width+=200),e.y+50>this.hoverLayer.canvas.height&&(this.canvas.height+=200),this.offscreen.canvas.width=this.canvas.width,this.offscreen.canvas.height=this.canvas.height,this.hoverLayer.canvas.width=this.canvas.width,this.hoverLayer.canvas.height=this.canvas.height,this.activeLayer.canvas.width=this.canvas.width,this.activeLayer.canvas.height=this.canvas.height,this.options.on&&this.options.on("resize",{width:this.canvas.width,height:this.canvas.height})),this.moveIn.type){case ye.None:if(this.hoverLayer.dragRect=new l(this.mouseDown.x,this.mouseDown.y,e.x-this.mouseDown.x,e.y-this.mouseDown.y),!t)return void this.hoverLayer.render();break;case ye.Nodes:this.nodesMoved=!0;const i=e.x-this.mouseDown.x,r=e.y-this.mouseDown.y;if(i||r){const t=this.getDockPos(i,r);this.activeLayer.moveNodes(t.x?t.x:i,t.y?t.y:r),this.options.on&&this.options.on("moveNodes",this.activeLayer.nodes)}break;case ye.ResizeCP:this.activeLayer.resizeNodes(this.moveIn.activeAnchorIndex,e),this.options.on&&this.options.on("resizeNodes",this.activeLayer.nodes);break;case ye.LineTo:case ye.HoverAnchors:let n=this.toArrowType;this.moveIn.hoverLine&&(n=this.moveIn.hoverLine.toArrow),this.hoverLayer.lineTo(this.getLineDock(e),n);break;case ye.LineFrom:this.hoverLayer.lineFrom(this.getLineDock(e));break;case ye.LineMove:this.hoverLayer.lineMove(e,this.mouseDown);break;case ye.LineControlPoint:this.moveIn.hoverLine.controlPoints[this.moveIn.lineControlPoint.id].x=e.x,this.moveIn.hoverLine.controlPoints[this.moveIn.lineControlPoint.id].y=e.y,ie[this.moveIn.hoverLine.name]&&ie[this.moveIn.hoverLine.name].dockControlPointFn&&ie[this.moveIn.hoverLine.name].dockControlPointFn(this.moveIn.hoverLine.controlPoints[this.moveIn.lineControlPoint.id],this.moveIn.hoverLine);break;case ye.Rotate:this.activeLayer.nodes.length&&(this.activeLayer.offsetRotate(this.getAngle(e)),this.activeLayer.updateLines()),this.options.on&&this.options.on("rotateNodes",this.activeLayer.nodes)}this.hoverLayer.render(),this.activeLayer.render(),this.animateLayer.render(),this.offscreen.render()})},this.onmousedown=t=>{switch(this.mouseDown={x:t.offsetX,y:t.offsetY},Z.Store.set("activeLine",null),t.altKey&&(this.hoverLayer.canvas.style.cursor="move"),this.inputNode&&this.setNodeText(),this.moveIn.type){case ye.None:return this.activeLayer.nodes=[],this.activeLayer.lines=[],this.activeLayer.canvas.height=this.activeLayer.canvas.height,this.hoverLayer.node=null,this.hoverLayer.line=null,this.hoverLayer.canvas.height=this.hoverLayer.canvas.height,void(this.options.on&&this.options.on("space",null));case ye.Line:case ye.LineControlPoint:return t.ctrlKey?(this.activeLayer.lines.push(this.moveIn.hoverLine),this.options.on&&(this.lines.length>1||this.nodes.length?this.options.on("multi",{nodes:this.activeLayer.nodes,lines:this.activeLayer.lines}):this.options.on("line",this.moveIn.hoverLine))):(this.activeLayer.nodes=[],this.activeLayer.lines=[this.moveIn.hoverLine],this.options.on&&this.options.on("line",this.moveIn.hoverLine)),Z.Store.set("activeLine",this.moveIn.hoverLine),this.hoverLayer.render(),void this.activeLayer.render();case ye.LineMove:this.hoverLayer.initLine=new he(this.moveIn.hoverLine);case ye.LineFrom:case ye.LineTo:return this.activeLayer.nodes=[],this.activeLayer.lines=[this.moveIn.hoverLine],this.options.on&&this.options.on("line",this.moveIn.hoverLine),Z.Store.set("activeLine",this.moveIn.hoverLine),this.hoverLayer.line=this.moveIn.hoverLine,this.hoverLayer.render(),this.activeLayer.render(),void this.animateLayer.render();case ye.HoverAnchors:this.hoverLayer.setLine(new o(this.moveIn.hoverNode.rotatedAnchors[this.moveIn.hoverAnchorIndex].x,this.moveIn.hoverNode.rotatedAnchors[this.moveIn.hoverAnchorIndex].y,this.moveIn.hoverNode.rotatedAnchors[this.moveIn.hoverAnchorIndex].direction,this.moveIn.hoverAnchorIndex,this.moveIn.hoverNode.id),this.fromArrowType,this.lineName);case ye.Nodes:if(!this.moveIn.hoverNode||this.activeLayer.hasNode(this.moveIn.hoverNode))break;t.ctrlKey?(this.activeLayer.addNode(this.moveIn.hoverNode),this.options.on&&(this.activeLayer.nodes.length>1||this.activeLayer.lines.length?this.options.on("multi",{nodes:this.activeLayer.nodes,lines:this.activeLayer.lines}):this.options.on("node",this.moveIn.hoverNode))):(this.activeLayer.setNodes([this.moveIn.hoverNode]),this.options.on&&this.options.on("node",this.moveIn.hoverNode))}this.activeLayer.saveNodeRects(),this.activeLayer.render(),this.animateLayer.render()},this.onmouseup=t=>{if(this.mouseDown=null,this.lastTranlated.x&&this.cache(),this.lastTranlated.x=0,this.lastTranlated.y=0,this.hoverLayer.dockAnchor=null,this.hoverLayer.dockLineX=0,this.hoverLayer.dockLineY=0,this.hoverLayer.canvas.style.cursor="default",this.hoverLayer.dragRect)this.getRectNodes(this.nodes,this.hoverLayer.dragRect),this.getRectLines(this.lines,this.hoverLayer.dragRect),this.activeLayer.render(),this.options.on&&this.activeLayer.nodes&&this.activeLayer.nodes.length&&this.options.on("multi",{nodes:this.activeLayer.nodes,lines:this.activeLayer.lines});else switch(this.moveIn.type){case ye.HoverAnchors:this.hoverLayer.line&&this.hoverLayer.line.to&&(this.activeLayer.nodes=[],this.hoverLayer.line.to.id||!this.options.disableEmptyLine?(this.activeLayer.lines=[this.hoverLayer.line],Z.Store.set("activeLine",this.hoverLayer.line),this.options.on("line",this.hoverLayer.line)):this.lines.pop(),this.activeLayer.render()),this.offscreen.render(),this.hoverLayer.line=null;break;case ye.Rotate:this.activeLayer.updateRotate(),this.activeLayer.render(),this.animateLayer.render();break;case ye.LineControlPoint:Z.Store.set("pts-"+this.moveIn.hoverLine.id,null)}this.hoverLayer.dragRect=null,this.hoverLayer.render(),(this.nodesMoved||this.moveIn.type!==ye.None)&&this.cache(),this.nodesMoved=!1},this.ondblclick=t=>{switch(this.moveIn.type){case ye.Nodes:if(this.moveIn.hoverNode){const e=this.clickText(this.moveIn.hoverNode,new o(t.offsetX,t.offsetY));e&&this.showInput(e.node,e.textRect),this.options.on&&this.options.on("dblclick",this.moveIn.hoverNode)}}},this.onkeydown=t=>{let e=!1,i=0,r=0;switch(t.keyCode){case 8:case 46:if(!this.activeLayer.nodes.length&&!this.activeLayer.lines.length)return;this.delete();break;case 37:i=-5,t.ctrlKey&&(i=-1),e=!0;break;case 38:r=-5,t.ctrlKey&&(r=-1),e=!0;break;case 39:i=5,t.ctrlKey&&(i=1),e=!0;break;case 40:r=5,t.ctrlKey&&(r=1),e=!0}e&&((i||r)&&(this.activeLayer.saveNodeRects(),this.activeLayer.moveNodes(i,r)),this.activeLayer.render(),this.animateLayer.render(),this.hoverLayer.render(),this.offscreen.render(),this.cache())},this.options=e||{},this.options.font||(this.options.font={color:"#333",fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"center",textBaseline:"middle"}),this.options.color||(this.options.color="#000"),this.options.rotateCursor||(this.options.rotateCursor="/assets/img/rotate.cur"),this.options.font.fontFamily||(this.options.font.fontFamily='"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial'),this.options.font.color||(this.options.font.color="#333"),this.options.font.fontSize||(this.options.font.fontSize=12),this.options.font.lineHeight||(this.options.font.lineHeight=1.5),this.options.font.textAlign||(this.options.font.textAlign="center"),this.options.font.textBaseline||(this.options.font.textBaseline="middle"),Z.Store.set("nodes",this.nodes),Z.Store.set("lines",this.lines),this.parentElem="string"==typeof t?document.getElementById(t):t,this.offscreen=new se(this.options),Z.Store.set("offscreen",this.offscreen.canvas),this.parentElem.appendChild(this.canvas),this.activeLayer=new ae(this.parentElem,this.options),this.animateLayer=new le(this.parentElem,this.options),this.hoverLayer=new ce(this.parentElem,this.options),this.resize(),this.hoverLayer.canvas.ondragover=t=>t.preventDefault(),this.hoverLayer.canvas.ondrop=t=>{this.ondrop(t)},this.subcribe=Z.Store.subcribe("render",()=>{this.renderOffscreen()}),this.subcribeAnimateMoved=Z.Store.subcribe("nodeMovedInAnimate",t=>{this.activeLayer.updateLines(this.nodes),this.activeLayer.render(),this.offscreen.render(),this.options.on&&this.options.on("nodeMovedInAnimate",t)}),this.subcribeAnimateEnd=Z.Store.subcribe("animateEnd",t=>{if(t){switch(t.type){case"line":for(const e of this.lines)if(e.id===t.data.id){e.animateStart=0;break}break;case"node":this.offscreen.render()}this.options.on&&this.options.on("animateEnd",t)}}),this.hoverLayer.canvas.onmousemove=this.onMouseMove,this.hoverLayer.canvas.onmousedown=this.onmousedown,this.hoverLayer.canvas.onmouseup=this.onmouseup,this.hoverLayer.canvas.ondblclick=this.ondblclick,this.hoverLayer.canvas.tabIndex=0,this.hoverLayer.canvas.onkeydown=this.onkeydown,this.hoverLayer.canvas.onwheel=t=>{t.altKey&&(t.preventDefault(),t.deltaY<0?this.scale(1.1):this.scale(.9),this.hoverLayer.canvas.focus())},this.hoverLayer.canvas.ontouchend=t=>{this.ontouched(t)},this.input.style.position="absolute",this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.input.style.height="0",this.input.style.outline="none",this.input.style.border="1px solid #cdcdcd",this.input.style.resize="none",this.parentElem.appendChild(this.input),this.canvas.style.outline="none",this.cache()}resize(t){t?(this.canvas.width=t.width,this.canvas.height=t.height):(this.options.width&&"auto"!==this.options.width?this.canvas.width=+this.options.width:this.canvas.width=this.parentElem.clientWidth,this.options.height&&"auto"!==this.options.height?this.canvas.height=+this.options.height:this.canvas.height=this.parentElem.clientHeight-8),this.offscreen.resize(this.canvas.width,this.canvas.height),this.hoverLayer.resize(this.canvas.width,this.canvas.height),this.activeLayer.resize(this.canvas.width,this.canvas.height),this.animateLayer.resize(this.canvas.width,this.canvas.height),this.render(),this.options.on&&this.options.on("resize",{width:this.canvas.width,height:this.canvas.height})}ondrop(t){t.preventDefault();const e=JSON.parse(t.dataTransfer.getData("Text"));e.rect.x=t.offsetX-e.rect.width/2<<0,e.rect.y=t.offsetY-e.rect.height/2<<0,this.addNode(new oe(e))}getTouchOffset(t){let e=this.parentElem,i=0,r=0;for(;e;)i+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{offsetX:t.pageX-i,offsetY:t.pageY-r}}ontouched(t){if(!this.touchedNode)return;const e=this.getTouchOffset(t.changedTouches[0]);this.touchedNode.rect.x=e.offsetX-this.touchedNode.rect.width/2,this.touchedNode.rect.y=e.offsetY-this.touchedNode.rect.height/2,this.addNode(new oe(this.touchedNode)),this.touchedNode=void 0}addNode(t){return!!Qt[t.name]&&(1!==this.scaleState&&t.scale(this.scaleState),this.activeLayer.setNodes([t]),this.activeLayer.render(),this.hoverLayer.canvas.focus(),this.nodes.push(t),this.offscreen.render(),this.cache(),this.options.on&&this.options.on("node",t),!0)}render(){this.activeLayer.nodes=[],this.activeLayer.lines=[],this.hoverLayer.node=null,this.hoverLayer.line=null,Z.Store.set("activeLine",null),this.hoverLayer.render(),this.activeLayer.render(),this.animateLayer.render(),this.offscreen.render()}open(t){this.animateLayer.nodes=[],this.animateLayer.lines=[],this.lock(t.locked||0),t.lineName&&(this.lineName=t.lineName),this.scaleState=t.scaleState||1,Z.Store.set("scale",this.scaleState),this.options.on&&this.options.on("scale",this.scaleState),this.nodes.splice(0,this.nodes.length),this.lines.splice(0,this.lines.length);for(const e of t.nodes)this.nodes.push(new oe(e));for(const e of t.lines)this.lines.push(new he(e));this.caches.list=[],this.cache(),this.overflow(),this.render()}overflow(){const t=this.getRect();(t.width>this.canvas.width||t.height>this.canvas.height)&&this.resize({width:t.ex+200,height:t.ey+200})}renderOffscreen(){this.canvas.height=this.canvas.height,this.canvas.getContext("2d").drawImage(this.offscreen.canvas,0,0)}setNodeText(){this.inputNode.text=this.input.value,this.input.style.zIndex="-1",this.input.style.left="-1000px",this.input.style.width="0",this.inputNode=null,this.cache(),this.offscreen.render()}clickText(t,e){const i=t.getTextRect();if(i.hitRotate(e,t.rotate,t.rect.center))return{node:t,textRect:i};if(!t.children)return null;for(const i of t.children){const t=this.clickText(i,e);if(t)return t}return null}getHoverNode(t){for(let e=this.activeLayer.nodes.length-1;e>-1;--e)if(this.activeLayer.nodes[e].hit(t,2))return this.moveIn.hoverNode=this.activeLayer.nodes[e],void(this.moveIn.type=ye.Nodes);for(let e=this.nodes.length-1;e>-1;--e)if(this.nodes[e].hit(t,2)){this.moveIn.hoverNode=this.nodes[e],this.moveIn.type=ye.Nodes;break}}getMoveIn(t){if(this.lastHoverNode=this.moveIn.hoverNode,this.moveIn.type=ye.None,this.moveIn.hoverNode=null,this.moveIn.lineControlPoint=null,this.moveIn.hoverLine=null,this.hoverLayer.hoverAnchorIndex=-1,1!==this.locked)for(const e of this.activeLayer.lines)if(this.isInLine(t,e))return;if(this.getHoverNode(t),this.moveIn.hoverNode?this.hoverLayer.canvas.style.cursor="move":this.hoverLayer.canvas.style.cursor="default",this.activeLayer.nodes.length)if(this.activeLayer.rotateCPs[0].hit(t,15))this.moveIn.type=ye.Rotate,this.hoverLayer.canvas.style.cursor=`url("${this.options.rotateCursor}"), auto`;else if(h(t,this.activeLayer.sizeCPs)&&(this.moveIn.type=ye.Nodes,this.hoverLayer.canvas.style.cursor="move"),!this.locked)for(let e=0;e<this.activeLayer.sizeCPs.length;++e)if(this.activeLayer.sizeCPs[e].hit(t,10)){this.moveIn.type=ye.ResizeCP,this.moveIn.activeAnchorIndex=e,this.hoverLayer.canvas.style.cursor=de[e];break}if(this.moveIn.type===ye.ResizeCP||this.moveIn.type===ye.Rotate)return;if(this.moveIn.hoverNode&&!this.locked)for(let e=0;e<this.moveIn.hoverNode.rotatedAnchors.length;++e)if(this.moveIn.hoverNode.rotatedAnchors[e].hit(t,8))return this.moveIn.type=ye.HoverAnchors,this.moveIn.hoverAnchorIndex=e,this.hoverLayer.hoverAnchorIndex=e,void(this.hoverLayer.canvas.style.cursor="crosshair");if(1===this.locked)return;let e=0;for(const i of this.lines)if(++e,i.to){if(this.isInLine(t,i))return}else this.lines.splice(e-1,1)}isInLine(t,e){if(this.activeLayer.lines.length){let i=0;for(const r of e.controlPoints){if(r.hit(t))return r.id=i,this.moveIn.type=ye.LineControlPoint,this.moveIn.lineControlPoint=r,this.moveIn.hoverLine=e,this.hoverLayer.canvas.style.cursor="pointer",!0;++i}}return e.from.hit(t,10)?(this.moveIn.type=ye.LineFrom,this.moveIn.hoverLine=e,this.hoverLayer.canvas.style.cursor="move",!0):e.to.hit(t,10)?(this.moveIn.type=ye.LineTo,this.moveIn.hoverLine=e,this.hoverLayer.canvas.style.cursor="move",!0):!!e.pointIn(t)&&(this.moveIn.type=ye.LineMove,this.moveIn.hoverLine=e,this.hoverLayer.canvas.style.cursor="move",(e.from.id||e.to.id)&&(this.moveIn.type=ye.Line,this.hoverLayer.canvas.style.cursor="pointer"),!0)}getLineDock(t){this.hoverLayer.dockAnchor=null;for(const e of this.nodes){e.rect.hit(t,10)&&(this.hoverLayer.node=e);for(let i=0;i<e.rotatedAnchors.length;++i)if(e.rotatedAnchors[i].hit(t,10)){t.id=e.id,t.anchorIndex=i,t.direction=e.rotatedAnchors[t.anchorIndex].direction,t.x=e.rotatedAnchors[t.anchorIndex].x,t.y=e.rotatedAnchors[t.anchorIndex].y,this.hoverLayer.dockAnchor=e.rotatedAnchors[i];break}if(t.id)break}return t}getRectNodes(t,e){e.width<0&&(e.width=-e.width,e.x=e.ex,e.ex=e.x+e.width),e.height<0&&(e.height=-e.height,e.y=e.ey,e.ey=e.y+e.height);for(const i of t)e.hitRect(i.rect)&&this.activeLayer.addNode(i)}getRectLines(t,e){e.width<0&&(e.width=-e.width,e.x=e.ex,e.ex=e.x+e.width),e.height<0&&(e.height=-e.height,e.y=e.ey,e.ey=e.y+e.height),this.activeLayer.lines=[];for(const i of t)e.hit(i.from)&&e.hit(i.to)&&this.activeLayer.lines.push(i)}getAngle(t){if(t.x===this.activeLayer.rect.center.x)return t.y<=this.activeLayer.rect.center.y?0:180;if(t.y===this.activeLayer.rect.center.y)return t.x<this.activeLayer.rect.center.x?270:90;const e=t.x-this.activeLayer.rect.center.x,i=t.y-this.activeLayer.rect.center.y;let r=Math.atan(Math.abs(e/i))/(2*Math.PI)*360;return e>0&&i>0?r=180-r:e<0&&i>0?r+=180:e<0&&i<0&&(r=360-r),1===this.activeLayer.nodes.length?r-this.activeLayer.nodes[0].rotate:r}showInput(t,e){this.locked||this.options.hideInput||(this.inputNode=t,this.input.value=t.text,this.input.style.left=e.x+"px",this.input.style.top=e.y+"px",this.input.style.width=e.width+"px",this.input.style.height=e.height+"px",this.input.style.zIndex="1000",this.input.focus())}getRect(){let t=99999,e=99999,i=-99999,r=-99999;const n=[];for(const t of this.nodes){const e=t.rect.toPoints();if(t.rotate)for(const i of e)i.rotate(t.rotate,t.rect.center);n.push.apply(n,e)}for(const t of this.lines)if(n.push(t.from),n.push(t.to),"curve"===t.name)for(let e=.01;e<1;e+=.02)n.push(ot(e,t.from,t.controlPoints[0],t.controlPoints[1],t.to));for(const o of n)t>o.x&&(t=o.x),e>o.y&&(e=o.y),i<o.x&&(i=o.x),r<o.y&&(r=o.y);return new l(t,e,i-t,r-e)}getNodesRect(t){let e=99999,i=99999,r=-99999,n=-99999;const o=[];for(const e of t){const t=e.rect.toPoints();if(e.rotate)for(const i of t)i.rotate(e.rotate,e.rect.center);o.push.apply(o,t)}for(const t of o)e>t.x&&(e=t.x),i>t.y&&(i=t.y),r<t.x&&(r=t.x),n<t.y&&(n=t.y);return new l(e,i,r-e,n-i)}getDockPos(t,e){this.hoverLayer.dockLineX=0,this.hoverLayer.dockLineY=0;const i={x:0,y:0};let r=0,n=0,o=xe,h=xe;for(const s of this.activeLayer.dockWatchers)for(const c of this.nodes)if(!this.activeLayer.hasNode(c)&&"text"!==c.name){c.dockWatchers||c.getDockWatchers();for(const a of c.dockWatchers)(r=Math.abs(a.x-s.x-t))<o&&(o=-99999,i.x=a.x-s.x,this.hoverLayer.dockLineX=a.x),(n=Math.abs(a.y-s.y-e))<h&&(h=-99999,i.y=a.y-s.y,this.hoverLayer.dockLineY=a.y)}return i}cache(){const t={nodes:[],lines:[]};for(const e of this.nodes)t.nodes.push(new oe(e));for(const e of this.lines)t.lines.push(new he(e));this.caches.index<this.caches.list.length-1?this.caches.list.splice(this.caches.index+1,this.caches.list.length-this.caches.index-1,t):this.caches.list.push(t),this.caches.index=this.caches.list.length-1}undo(){if(this.locked||this.caches.index<1)return;const t=this.caches.list[--this.caches.index];this.nodes.splice(0,this.nodes.length),this.lines.splice(0,this.lines.length),this.nodes.push.apply(this.nodes,t.nodes),this.lines.push.apply(this.lines,t.lines),this.render()}redo(){if(this.locked||this.caches.index>this.caches.list.length-2)return;const t=this.caches.list[++this.caches.index];this.nodes.splice(0,this.nodes.length),this.lines.splice(0,this.lines.length),this.nodes.push.apply(this.nodes,t.nodes),this.lines.push.apply(this.lines,t.lines),this.render()}data(){return{nodes:this.nodes,lines:this.lines,lineName:this.lineName,fromArrowType:this.fromArrowType,toArrowType:this.toArrowType,scaleState:this.scaleState,locked:this.locked}}toImage(t,e,i){const r=this.getRect(),n=document.createElement("canvas");n.width=r.width+20,n.height=r.height+20;const o=n.getContext("2d");return t&&"image/png"!==t&&(o.fillStyle="white",o.fillRect(0,0,n.width,n.height)),o.drawImage(this.offscreen.canvas,r.x-10,r.y-10,r.width+20,r.height+20,0,0,r.width+20,r.height+20),i?(n.toBlob(i),""):n.toDataURL(t,e)}saveAsImage(t,e,i){const r=document.createElement("a");r.setAttribute("download",t||"le5le.topology.png"),r.setAttribute("href",this.toImage(e,i));const n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),r.dispatchEvent(n)}delete(){let t=0;for(const e of this.activeLayer.lines){t=0;for(const i of this.lines){if(e.id===i.id){this.lines.splice(t,1);break}++t}}for(const e of this.activeLayer.nodes)(t=this.findNode(e))>-1&&this.nodes.splice(t,1);this.activeLayer.saveNodeRects(),this.render(),this.cache()}cut(){if(!this.locked){this.clipboard={nodes:[],lines:[]};for(const t of this.activeLayer.nodes){this.clipboard.nodes.push(new oe(t));const e=this.findNode(t);e>-1&&this.nodes.splice(e,1)}for(const t of this.activeLayer.lines){this.clipboard.lines.push(new he(t));let e=0;for(const i of this.lines)t.id===i.id&&this.lines.splice(e,1),++e}this.cache(),this.activeLayer.nodes=[],this.activeLayer.lines=[],this.activeLayer.render(),this.animateLayer.render(),this.hoverLayer.node=null,this.hoverLayer.render(),this.offscreen.render(),this.moveIn.hoverLine=null,this.moveIn.hoverNode=null}}copy(){this.clipboard={nodes:[],lines:[]};for(const t of this.activeLayer.nodes)this.clipboard.nodes.push(new oe(t));for(const t of this.activeLayer.lines)this.clipboard.lines.push(new he(t))}parse(){if(!this.clipboard||this.locked)return;this.hoverLayer.node=null,this.hoverLayer.line=null,this.hoverLayer.render(),this.activeLayer.nodes=[],this.activeLayer.lines=[];const t={};for(const e of this.clipboard.nodes){const i=e.id;e.id=n(),t[i]=e.id,e.rect.x+=20,e.rect.ex+=20,e.rect.y+=20,e.rect.ey+=20;const r=new oe(e);this.nodes.push(r),this.activeLayer.nodes.push(r)}for(const e of this.clipboard.lines){e.id=n(),e.from=new o(e.from.x+20,e.from.y+20,e.from.direction,e.from.anchorIndex,t[e.from.id]),e.to=new o(e.to.x+20,e.to.y+20,e.to.direction,e.to.anchorIndex,t[e.to.id]);const i=new he(e);this.lines.push(i),this.activeLayer.lines.push(i),Z.Store.set("activeLine",i)}this.offscreen.render(),this.activeLayer.render(),this.animateLayer.render(),this.cache(),this.clipboard.nodes.length>1||this.clipboard.lines.length>1||this.clipboard.nodes.length&&this.clipboard.lines.length?this.options.on("multi",{nodes:this.clipboard.nodes,lines:this.clipboard.lines}):this.clipboard.nodes.length?this.options.on("node",this.activeLayer.nodes[0]):this.clipboard.lines.length&&this.options.on("line",this.activeLayer.lines[0])}animate(){this.offscreen.render(),this.animateLayer.render(!1)}updateProps(t,e,i){this.activeLayer.updateProps(t,e,i),this.activeLayer.saveNodeRects(),this.activeLayer.changeLineType(),this.activeLayer.render(),this.animateLayer.render(),this.hoverLayer.render(),this.offscreen.render(),this.cache()}lock(t){this.locked=t,Z.Store.set("locked",t),this.options.on&&this.options.on("locked",this.locked)}top(t){const e=this.findNode(t);e>-1&&(this.nodes.push(this.nodes[e]),this.nodes.splice(e,1))}bottom(t){const e=this.findNode(t);e>-1&&(this.nodes.unshift(this.nodes[e]),this.nodes.splice(e+1,1))}combine(t){const e=this.getNodesRect(t);for(const e of t){const t=this.findNode(e);t>-1&&this.nodes.splice(t,1)}const i=new oe({name:"combine",rect:e,text:"",strokeStyle:"transparent"});i.children=[];for(const e of t)e.parentId=i.id,e.parentRect={offsetX:10,offsetY:10,x:(e.rect.x-i.rect.x-10)/(i.rect.width-10),y:(e.rect.y-i.rect.y-10)/(i.rect.height-10),width:e.rect.width/(i.rect.width-10),height:e.rect.height/(i.rect.height-10),marginX:0,marginY:0,rotate:e.rotate},i.children.push(e);this.nodes.push(i),this.cache()}uncombine(t){if("combine"!==t.name)return;const e=this.findNode(t);e>-1&&this.nodes.splice(e,1);for(const e of t.children)e.parentId=void 0,e.parentRect=void 0,this.nodes.push(e);this.cache()}findNode(t){for(let e=0;e<this.nodes.length;++e)if(t.id===this.nodes[e].id)return e;return-1}translate(t,e){const i=t-this.lastTranlated.x,r=e-this.lastTranlated.y;for(const t of this.nodes)t.rect.x+=i,t.rect.y+=r,t.rect.ex=t.rect.x+t.rect.width,t.rect.ey=t.rect.y+t.rect.height,t.rect.calceCenter(),t.init(),this.activeLayer.updateChildren(t);for(const t of this.lines){t.from.x+=i,t.from.y+=r,t.to.x+=i,t.to.y+=r;for(const e of t.controlPoints)e.x+=i,e.y+=r;Z.Store.set("pts-"+t.id,null)}this.lastTranlated.x=t,this.lastTranlated.y=e,this.overflow(),this.render(),this.cache(),this.options.on&&this.options.on("translate",{x:t,y:e})}scale(t){this.scaleState*=t;const e=this.getRect().center;for(const i of this.nodes)i.scale(t,e),this.activeLayer.updateChildren(i);for(const i of this.lines){i.from.x=e.x-(e.x-i.from.x)*t,i.from.y=e.y-(e.y-i.from.y)*t,i.to.x=e.x-(e.x-i.to.x)*t,i.to.y=e.y-(e.y-i.to.y)*t;for(const r of i.controlPoints)r.x=e.x-(e.x-r.x)*t,r.y=e.y-(e.y-r.y)*t;Z.Store.set("pts-"+i.id,null)}Z.Store.set("scale",this.scaleState),this.overflow(),this.render(),this.cache(),this.options.on&&this.options.on("scale",this.scaleState)}scaleTo(t){this.scale(t/this.scaleState)}destory(){this.subcribe.unsubcribe(),this.subcribeAnimateEnd.unsubcribe(),this.subcribeAnimateMoved.unsubcribe()}},registerNode:ne,Pen:d,Node:oe,Point:o,Line:he,Rect:l,Store:fe.Store,Observer:fe.Observer,s8:n}}])}));